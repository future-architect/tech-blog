---
title: "WSLã§å§‹ã‚ã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰Swift å…¥é–€ ï½Hummingbirdï½"
date: 2024/04/18 00:00:00
postid: a
tag:
  - Swift
  - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰Swift
  - WSL
  - Ubuntu
  - Hummingbird
category:
  - Infrastructure
thumbnail: /images/20240418a/thumbnail.png
author: æ¸…æ°´é›„ä¸€éƒ
lede: "![image.png]ã“ã‚“ã«ã¡ã¯ã€‚HealthCare Innovation Group[^1]æ‰€å±ã®æ¸…æ°´ã§ã™ã€‚[æ˜¥ã®å…¥é–€é€£è¼‰2024]ã€6æœ¬ç›®ã®è¨˜äº‹ã§ã™ã€‚"
---
<img src="/images/20240418a/image.png" alt="image.png" width="851" height="200" loading="lazy">

# ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚HealthCare Innovation Group(HIG)[^1]æ‰€å±ã®æ¸…æ°´ã§ã™ã€‚
[æ˜¥ã®å…¥é–€é€£è¼‰2024](/articles/20240408a/)ã€6æœ¬ç›®ã®è¨˜äº‹ã§ã™ã€‚

Swiftã«ãŠã‘ã‚‹Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å–ã‚Šä¸Šã’ã¾ã™ã€‚Swift[^7]ã¯iOSã‚¢ãƒ—ãƒªé–‹ç™ºã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¼·ã„ã¨æ€ã„ã¾ã™ãŒã€iOSã‚¢ãƒ—ãƒªé–‹ç™ºä»¥å¤–ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ï¼ˆmacOSä»¥å¤–ã§ã‚‚SwiftãŒå‹•ã‹ã›ãŸã‚‰æ¥½ã—ã„ãªã¨ã„ã†ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã§è¨˜äº‹ã‚’åŸ·ç­†ã—ã¦ãŠã‚Šã¾ã™ã€‚ï¼‰

## Swift ã«ãŠã‘ã‚‹ Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

ãã‚‚ãã‚‚Swiftã«ãŠã‘ã‚‹Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€ä½•ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ

Swift.org[^8]ã®[Swift on Server](https://www.swift.org/documentation/server/)å†…ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ä»¥ä¸‹2ã¤ã§ã™ã€‚

- [Hummingbird](https://swiftpackageindex.com/hummingbird-project/hummingbird)
- [Vapor](https://vapor.codes/)

GitHub Star æ•°ã‚’æ¯”è¼ƒã—ãŸå›³ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

å…ˆç™ºã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹Vaporã®æ–¹ãŒäººæ°—ã§ã€æ¤œç´¢ã™ã‚‹ã¨æ—¥æœ¬èªè¨˜äº‹ã‚‚ã„ãã¤ã‹ãƒ’ãƒƒãƒˆã—ã¾ã™ã€‚Swift.orgå†…ã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«[^2]ã¨ã—ã¦å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã‚‚ã€VaporãŒä¸»æµã¨ãªã£ã¦ã„ã‚‹ã“ã¨ãŒä¼ºãˆã¾ã™ã€‚Vaporã«ã¤ã„ã¦ã¯è¨˜äº‹ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã‚‚å¤šã„ãŸã‚ã€å¾Œç™ºã®Hummingbirdã‚’è©¦ã—ã¾ã™ã€‚

<img src="/images/20240418a/star-history-2024416.png" alt="" width="1200" height="866" loading="lazy">
ï¼ˆå‚è€ƒï¼šhttps://star-history.com/#hummingbird-project/hummingbird&vapor/vapor&Dateï¼‰

## Hummingbird ã¨ã¯

è»½é‡ã§ä¾å­˜é–¢ä¿‚ãŒå°‘ãªã„ã“ã¨ã‚’å£²ã‚Šã¨ã—ã¦ã„ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸€ã¤ã§ã™ã€‚

Hummingbird ã® README ã«ã‚‚ä»¥ä¸‹ã®è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚

> Lightweight, flexible, modern server framework written in Swift.

Hummingbird ã¯ã€æœ€å°é™ã®ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã¿ã‚’æä¾›ã—ã¦ã€å€‹åˆ¥ã§æ‹¡å¼µã—ã¦ã„ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚å‰è¿°ã® Vapor ã®æ–¹ãŒæ©Ÿèƒ½è‡ªä½“ã¯è±Šå¯Œã ã¨æ€ã„ã¾ã™ãŒã€ã‚µã‚¯ãƒƒã¨ä½¿ã„ãŸã„å ´åˆã¯ Hummingbird ãªã®ã‹ãªã¨èªè­˜ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒAppleã®Developerå‘ã‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[^10]ãã£ãã‚Šãªã®ã§ã€ãœã²è¦—ã„ã¦ã¿ã¦ã»ã—ã„ã§ã™ã€‚

https://docs.hummingbird.codes/2.0/documentation/hummingbird/

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ç’°å¢ƒæƒ…å ±

æœ¬è¨˜äº‹ã¯ã€ä»¥ä¸‹ã®ç’°å¢ƒã§å®Ÿæ–½ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

- Windows Subsystem for Linux ï¼ˆä»¥ä¸‹ã€WSLï¼‰ã«é–¢ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
    ```sh cmd.exe
    >wsl -v
    WSL ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.1.5.0
    ã‚«ãƒ¼ãƒãƒ« ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 5.15.146.1-2
    WSLg ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.60
    MSRDC ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.2.5105
    Direct3D ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.611.1-81528511
    DXCore ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp
    Windows ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 10.0.19045.4170
    ```
- Ubuntu ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 22.04.4 LTS
- Swift ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 5.10

### Swift ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯ã€Swiftã‚’Ubuntuä¸Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
[Hummingbirdã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.hummingbird.codes/2.0/documentation/hummingbird/)ã«ã¯Swiftè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«é–¢ã™ã‚‹è¨˜è¼‰ã¯ãªã‹ã£ãŸãŸã‚ã€[Vaporã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.vapor.codes/ja/install/linux/)ã‚’å‚è€ƒã«Swiftly[^3]ã‚’ç”¨ã„ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
Swiftly ã¯ã€Swift Server Workgroup[^9] ãŒæä¾›ã™ã‚‹CLIãƒ„ãƒ¼ãƒ«ã§ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Swiftã‚’ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
è¨˜è¼‰ã®æ‰‹é †é€šã‚Šã€å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚

```bash
# swiftly ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
> curl -L https://swift-server.github.io/swiftly/swiftly-install.sh | bash
~~~
Select one of the following:
1) Proceed with the installation (default)
2) Customize the installation
3) Cancel
> 1
~~~
# `swiftly` ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãŸã‚ã€PATH ã¸è¿½åŠ 
> . $HOME/.local/share/swiftly/env.sh

# æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® Swift ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
> swiftly install latest
~~~
Set the active toolchain to Swift 5.10.0
Swift 5.10.0 installed successfully!

# Swift ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
> swift --version
Swift version 5.10 (swift-5.10-RELEASE)
Target: x86_64-unknown-linux-gnu
```

## Hummingbird ã‚’ç”¨ã„ãŸToDoã‚¢ãƒ—ãƒªã®æ§‹ç¯‰ï¼ˆå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼‰

ã“ã“ã‹ã‚‰å…ˆã¯ã€Hummingbird å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¼‰ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å…ƒã« Hummingbird ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ToDoã‚¢ãƒ—ãƒªã®æ§‹ç¯‰ã¾ã§ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

https://docs.hummingbird.codes/2.0/tutorials/todos/

### Hummingbird ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆDirectoryã®ä½œæˆ
> mkdir Todos
> cd Todos
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¿…è¦ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§åˆæœŸåŒ–
> swift package init --type tool
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®ç¢ºèª
>  tree
.
â”œâ”€â”€ Package.resolved # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚è§£æ±ºã‚’è¨˜éŒ²
â”œâ”€â”€ Package.swift # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¨˜è¼‰
â””â”€â”€ Sources
    â””â”€â”€ Todos.swift # æœ¬ä½“
```

<details><summary>--type tool ã«ã¤ã„ã¦</summary>

`--type tool` ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§åˆ©ç”¨ã§ãã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¿ãŸã„ã§ã™ã€‚
`Package.swift` ã«ã€ https://github.com/apple/swift-argument-parser.git ãŒå«ã¾ã‚Œã‚‹ã‹å¦ã‹ã¨ç½®ãæ›ãˆã¦ã‚‚å•é¡Œãªã„ã¨æ€ã„ã¾ã™ã€‚

```bash  --type executable ã®å ´åˆ
> swift package init --type executable
Creating executable package: Sample
Creating Package.swift
Creating .gitignore
Creating Sources/
Creating Sources/main.swift
```

```swift Package.swift
// swift-tools-version: 5.10
// The swift-tools-version declares the minimum version of Swift required to build this package.
import PackageDescription

let package = Package(
    name: "Sample",
    targets: [
        // Targets are the basic building blocks of a package, defining a module or a test suite.
        // Targets can depend on other targets in this package and products from dependencies.
        .executableTarget(
            name: "Sample"),
    ]
)
```

</details>

Hummingbird ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€`Package.swift` ã«å¿…è¦ãªæƒ…å ±ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff Package.swift
// swift-tools-version: 5.10
// The swift-tools-version declares the minimum version of Swift required to build this package.
import PackageDescription

let package = Package(
    name: "Todos",
++  // macOS ä¸Šã§å‹•ã‹ã•ãªã„ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹ãŒå•é¡Œãªãå‹•ä½œã—ãŸã€‚
++  // platforms: [.macOS(.v14)],
    dependencies: [
        .package(url: "https://github.com/apple/swift-argument-parser.git", from: "1.2.0"),
++      .package(url: "https://github.com/hummingbird-project/hummingbird.git", from: "2.0.0-alpha.1"),
    ],
    targets: [
        .executableTarget(
            name: "Todos",
            dependencies: [
                .product(name: "ArgumentParser", package: "swift-argument-parser"),
++              .product(name: "Hummingbird", package: "hummingbird"),
            ]
        ),
    ]
)
```

GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å©ã„ãŸéš›ã«"Hello"ã‚’è¿”ã™ã‚ˆã†ã«ä»¥ä¸‹ã®ã‚ˆã†ã« `Todos.swift` ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

```swift Todos.swift
import ArgumentParser
import Hummingbird

@main
struct Todos: AsyncParsableCommand {
    func run() async throws {
        // create router
        let router = Router()
        // add hello route
        router.get("/") { request, context in
            "Hello\n"
        }
        // create application
        let app = Application(router: router)
        // run application
        try await app.runService()
    }
}
```

ä¸€é€£ã®ä¿®æ­£ãŒå®Œäº†ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ãã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚
```bash
> swift run
Building for debugging...
[8/8] Linking Todos
Build complete! (6.58s)
2024-04-16T15:18:49+0900 info Hummingbird : [HummingbirdCore] Server started and listening on 127.0.0.1:8080

# åˆ¥ã‚¿ãƒ–ã§å‹•ä½œç¢ºèª
> curl localhost:8080
Hello
```

ç°¡å˜ã§ã™ã­ğŸ‰

### ToDoã‚¢ãƒ—ãƒªã®æ§‹ç¯‰

ã“ã“ã§ã¯ã€Hummingbird ã‚’åˆ©ç”¨ã—ã¦ToDoã‚’DBã«ç™»éŒ²ã™ã‚‹ã¨ã“ã‚ã¾ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚
PostgresNIO[^4] ã¨ã„ã†PostgreSQLç”¨ã®Swiftã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ToDoã‚’PostgreSQLã«ç™»éŒ²ã—ã¾ã™ã€‚

Hummingbird åŒæ§˜ã«ã€PostgresNIO ã‚’ `Package.swift` ã«è¿½åŠ ã—ã¾ã™ã€‚

```diff Package.swift
// swift-tools-version: 5.10
// The swift-tools-version declares the minimum version of Swift required to build this package.
import PackageDescription

let package = Package(
    name: "Todos",
    // macOS ä¸Šã§å‹•ã‹ã•ãªã„ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹ãŒå•é¡Œãªãå‹•ä½œã—ãŸã€‚
    // platforms: [.macOS(.v14)],
    dependencies: [
        .package(url: "https://github.com/apple/swift-argument-parser.git", from: "1.2.0"),
        .package(url: "https://github.com/hummingbird-project/hummingbird.git", from: "2.0.0-alpha.1"),
++      .package(url: "https://github.com/vapor/postgres-nio.git", from: "1.21.0"),
    ],
    targets: [
        .executableTarget(
            name: "Todos",
            dependencies: [
                .product(name: "ArgumentParser", package: "swift-argument-parser"),
                .product(name: "Hummingbird", package: "hummingbird"),
++              .product(name: "PostgresNIO", package: "postgres-nio"),
            ]
        ),
    ]
)
```

PostgreSQL ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ï¼ˆãŠãã‚‰ãmacOSå‰æã§ï¼‰ `brew` çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãŸã®ã§ã™ãŒã€ä»Šå›ã¯ `apt` çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

<div class="note info" style="background: #e5f8e2; padding:16px; margin:24px 12px; border-radius:8px;">
  <span class="fa fa-fw fa-check-circle"></span>

Linux ä¸Šã§ã‚‚ Homebrew ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã¿ãŸã„ãªã®ã§ã€Homebrew çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
https://docs.brew.sh/Homebrew-on-Linux

</div>


```bash
> sudo apt update
> sudo apt install postgresql postgresql-contrib
> psql --version
psql (PostgreSQL) 14.11 (Ubuntu 14.11-0ubuntu0.22.04.1)
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã®ã§ã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ç¶šãã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

```bash
> psql postgres
psql: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: No such file or directory
        Is the server running locally and accepting connections on that socket?
```

ã‚¨ãƒ©ãƒ¼ã§é€²ã‚ã¾ã›ã‚“ã€‚
ã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦èª¿ã¹ã‚‹ã¨ `.conf` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã‚ˆã†[^5]ã€ãªã©ã¨ã‚ã‚Šã¾ã™ãŒã€ãã‚‚ãã‚‚`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚“ã ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`/etc/postgresql/14/main/`ï¼‰ãŒãªã„ã“ã¨ã«æ°—ãŒä»˜ãã¾ã—ãŸã€‚

```bash
> ls -la /etc/postgresql/
total 8
drwxr-xr-x  2 postgres postgres 4096 Feb 10  2022 .
drwxr-xr-x 84 root     root     4096 Apr 17 06:54 ..
```

åˆ¥ã®è¨˜äº‹[^6]ã‚’å‚è€ƒã«ã€PostgreSQL ã®ã‚¯ãƒ©ã‚¹ã‚¿ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
> sudo pg_createcluster --start 14 main
> ls -la /etc/postgresql/14/main/
conf.d/          pg_ctl.conf      pg_ident.conf    start.conf
environment      pg_hba.conf      postgresql.conf
```

å‹•ãã‚ˆã†ã«ãªã£ãŸã®ã§ã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ç¶šãã«æˆ»ã‚Šã¾ã™ã€‚
ã¾ãšã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æº–å‚™ã—ã¾ã™ã€‚

```bash
> postgres psql
psql (14.11 (Ubuntu 14.11-0ubuntu0.22.04.1))
Type "help" for help.

postgres=# create database hummingbird;
CREATE DATABASE
postgres=# \c hummingbird
You are now connected to database "hummingbird" as user "postgres".
hummingbird=# create role todos createrole login password 'todos';
CREATE ROLE
hummingbird=# \q
```

æ¬¡ã«ã€ToDoã‚¢ãƒ—ãƒªã®å®Ÿè£…ã§ã™ã€‚
ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®é€šã‚Šã«å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚å®Œæˆå½¢ã¯ã€å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚‹ãŸã‚ã€ãã¡ã‚‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

https://github.com/hummingbird-project/hummingbird-examples/tree/main/todos-postgres-tutorial

### å‹•ä½œç¢ºèª

ã“ã‚Œã¾ã§æ§‹ç¯‰ã—ãŸã‚‚ã®ã®å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

```bash
> swift run

# åˆ¥ã‚¿ãƒ–ã§å‹•ä½œç¢ºèª
# TODO ã‚’ç™»éŒ²
> curl -i -X POST localhost:8080/todos -d'{"title": "Wash my hair"}'
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8
Content-Length: 145
Date: Tue, 16 Apr 2024 23:54:54 GMT

{"id":"A4672369-753C-49AD-A41C-849AE5A7CF1E","url":"http:\/\/localhost:8080\/todos\/A4672369-753C-49AD-A41C-849AE5A7CF1E","title":"Wash my hair"}
> curl -i -X POST localhost:8080/todos -d'{"title": "Brush my teeth"}'
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8
Content-Length: 147
Date: Tue, 16 Apr 2024 23:55:03 GMT

{"url":"http:\/\/localhost:8080\/todos\/435A9B4F-BD4A-42E2-8EA9-5A5560378BBA","id":"435A9B4F-BD4A-42E2-8EA9-5A5560378BBA","title":"Brush my teeth"}

# DB ã®ç™»éŒ²çŠ¶æ…‹ã‚’ç¢ºèª
> psql hummingbird
psql (14.11 (Ubuntu 14.11-0ubuntu0.22.04.1))
Type "help" for help.

hummingbird=# select * from todos;
                  id                  |     title      | order | completed |                               url
--------------------------------------+----------------+-------+-----------+------------------------------------------------------------------
 a4672369-753c-49ad-a41c-849ae5a7cf1e | Wash my hair   |       |           | http://localhost:8080/todos/A4672369-753C-49AD-A41C-849AE5A7CF1E
 435a9b4f-bd4a-42e2-8ea9-5a5560378bba | Brush my teeth |       |           | http://localhost:8080/todos/435A9B4F-BD4A-42E2-8EA9-5A5560378BBA
(2 rows)
```

POSTã—ãŸToDoãŒã€DBå´ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸğŸ‰

# ã•ã„ã”ã«

Swift ã® Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸€ã¤ã§ã‚ã‚‹ã€Hummingbird ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ç´¹ä»‹ã—ã¾ã—ãŸã€‚

å€‹äººçš„ã«ã¯ã€macOSä»¥å¤–ã§ã‚‚SwiftãŒæ›¸ã‘ã¦ã€ã‹ã¤ã€ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªé–‹ç™ºã«åˆ©ç”¨ã§ãã‚‹ã“ã¨ãŒçŸ¥ã‚Œã¦æ¥½ã—ã‹ã£ãŸã§ã™ã€‚WSL ä¸Šã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸã®ã§æ‰‹é †ãŒå¤šã‚ã ã£ãŸã®ã§ã™ãŒã€æ™®æ®µSwiftã§iOSã‚¢ãƒ—ãƒªé–‹ç™ºã—ã¦ã„ã‚‹æ–¹ãŒã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®é–‹ç™ºã‚’è©¦ã—ãŸã„ã¨ãã«ä¾¿åˆ©ã ã¨æ€ã„ã¾ã—ãŸã€‚

ä»Šå›ã¯è©¦ã›ã¾ã›ã‚“ã§ã—ãŸãŒã€Xcode ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ¥ç¶šã¾ã§ã‚’ã©ã“ã‹ã§è©¦ã—ã¦ã¿ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

[^1]:åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢åˆ†é‡ã§ã®æ¡ˆä»¶ã‚„æ–°è¦ãƒ“ã‚¸ãƒã‚¹å‰µå‡ºã‚’æ‹…ã†ã€2020å¹´ã«èª•ç”Ÿã—ãŸäº‹æ¥­éƒ¨ã§ã™ã€‚
è¨­ç«‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã¯ã€ä»¥ä¸‹è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚
["æ–°è¦äº‹æ¥­ã®ç«‹ã¡ä¸Šã’ã€€ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼ã®çŸ¥ã‚‰ã‚Œã–ã‚‹åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢ã¸ã®æŒ‘æˆ¦"](https://note.future.co.jp/n/n8b57d4bf4604)
[^2]:Swift.orgå†…ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è¨˜äº‹
https://www.swift.org/getting-started/vapor-web-server/
[^3]:swiftly
https://github.com/swift-server/swiftly
[^4]:Postgres-NIO
https://github.com/vapor/postgres-nio
[^5]:psql: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: FATAL: Peer authentication failed for user "postgres" (Ubuntu)
https://stackoverflow.com/questions/69676009/psql-error-connection-to-server-on-socket-var-run-postgresql-s-pgsql-5432
[^6]:ã€Ubuntu+PostgreSQLã€‘postgresä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’ä½œæˆã—ã¦èµ·å‹•ã™ã‚‹
https://qiita.com/shin4488/items/175151e59a043c724b38
[^7]:https://www.apple.com/jp/swift/
[^8]:https://www.swift.org/
[^9]:Swift ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’ä¿ƒé€²ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—
https://www.swift.org/sswg/
[^10]:Appleã®Developerå‘ã‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
https://developer.apple.com/documentation/Swift

