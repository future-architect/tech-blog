---
title: "gRPCãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€šä¿¡ã®ç¬¬ä¸€ã®é¸æŠè‚¢ã«ãªã‚‹æ™‚ä»£ãŒã‚„ã£ã¦ããŸã‹ã‚‚ï¼Ÿ"
date: 2022/08/19 00:00:00
postid: a
tag:
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
  - gRPC
category:
  - Programming
thumbnail: /images/20220819a/thumbnail.png
author: æ¾å·å–œè¦
lede: "ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã¨IDLï¼ˆã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹è¨˜è¿°è¨€èªï¼‰é€£è¼‰ã®ä¸­ã§ã”ç´¹ä»‹ã—ãŸgRPCã®Goå®Ÿè£…ã®æ–°æ˜Ÿã€Connectã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚Go 1.19ãŒå‡ºãŸã‚‰connect-goã¯1.0ã«ã—ã¦ä»¥å¾Œå¾Œæ–¹äº’æ›æ€§ã‚’å®ˆã‚‹ã‚ˆã€connect-webã‚’å‡ºã™ã‚ˆã¨ã„ã†2ç‚¹ã§ã™ã€‚"
---

Go 1.19ãŒ8/2ã«æ—©ã€…ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚å€‹äººçš„ã«ã¯Go 1.19ã‚ˆã‚Šã‚‚æ¥½ã—ã¿ã ã£ãŸã®ãŒã€ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã¨IDLï¼ˆã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹è¨˜è¿°è¨€èªï¼‰é€£è¼‰ã®ä¸­ã§ã”ç´¹ä»‹ã—ãŸ[gRPCã®Goå®Ÿè£…ã®æ–°æ˜Ÿã€Connect](/articles/20220623a/)ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã—ãŸã€‚ãã—ã¦ãã‚Œã¯ã‚„ã£ã¦ãã¾ã—ãŸã€‚

è©³ã—ã„å†…å®¹ã¯â†‘ã®è¨˜äº‹ã‚’è¦‹ã¦ã„ãŸã ãã¨ã—ã¦ã€ConnectãŒ[ãã®é–‹ç™ºå…ƒãƒ–ãƒ­ã‚°ã®ç´¹ä»‹è¨˜äº‹](https://buf.build/blog/connect-a-better-grpc)ã§å®£è¨€ã—ã¦ã„ãŸã®ãŒæ¬¡ã®2ã¤ã®ã“ã¨ã§ã—ãŸã€‚

* Go 1.19ãŒå‡ºãŸã‚‰connect-goã¯1.0ã«ã—ã¦ä»¥å¾Œå¾Œæ–¹äº’æ›æ€§ã‚’å®ˆã‚‹ã‚ˆ
* connect-webã‚’å‡ºã™ã‚ˆ

å‰è€…ã¯ã¾ã 0.3ã ã£ãŸã®ã§ã™ãŒã€connect-webã¯ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚æ­´å²ã®ã‚ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã¯TypeScriptå¯¾å¿œãŒå¾Œä»˜ã‘ã ã£ãŸã‚Šã™ã‚‹ã®ã§ã™ãŒã€TypeScriptãŒãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚·ãƒã‚ºãƒ³ã‹ã¤ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãªã®ã§ã€é–‹ç™ºã¯ã‹ãªã‚Šã‚„ã‚Šã‚„ã™ããªã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚connect-webã®å…¬é–‹ã¯æ•°æ—¥å‰ã§ã—ãŸãŒã€æœ¬å®¶ã®ç´¹ä»‹è¨˜äº‹ã‚‚ã¡ã‚‡ã†ã©ä»Šæ—¥ã€å…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚

[Connect-Web: It's time for Protobuf and gRPC to be your first choice in the browser](https://buf.build/blog/connect-web-protobuf-grpc-in-the-browser)

æœ¬å®¶ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã‹ã‚‚ã¾ã ãªã„çŠ¶æ…‹ã§ã™ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãŸã‚‰ç°¡å˜ãã†ã ã£ãŸã®ã§ã€connect-goã¨ã‚»ãƒƒãƒˆã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ã—ã¦ã„ã¾ã™ã€‚

https://github.com/shibukawa/connect-test

å…ƒã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã§ã¯Ruby, Python, PHPã«ã‚‚å‡ºã—ã¦ã„ãã‚ˆå®£è¨€ãŒã‚ã‚Šã¾ã—ãŸãŒã€ä»Šå›ã®connect-webã®ãƒ–ãƒ­ã‚°ã«ã¯ã€Node.jsã€Android, iOSã«ã‚‚å‡ºã™ã‚ˆå®£è¨€ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚ã¨ã€[connect-webã®ä¸­ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://github.com/bufbuild/connect-web/blob/main/packages/connect-web/src/assert-fetch-api.ts#L23)ã‚’è¦‹ã‚‹ã¨ã€

> fetch()ãŒãªã„ã£ã¦ã“ã¨ã¯å¤ã„Node.jsä½¿ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿconnect-nodeã‚’å¾…ã£ã¦ã¦ï¼

ã¨ã‚ã‚‹ã®ã§ã€ä»Šã§ã‚‚``fetch()``ã®ã‚ã‚‹Node.js 18ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãªã‚‰å‹•ä½œã—ãã†ã§ã™ã­ã€‚

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¨åˆæœŸåŒ–

ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚Goã®æ¨™æº–çš„ãªæ§‹æˆ(ãƒˆãƒƒãƒ—ã«go.modã€cmdãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ)ã«ãƒ—ãƒ©ã‚¹ã—ã¦ã€frontendã¨ã„ã†ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’èµ·ãã¾ã—ãŸã€‚

```sh
connect-test
â”œâ”€â”€ buf.gen.yaml           # ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®è¨­å®šã€‚ä¿®æ­£å¿…è¦ã€‚
â”œâ”€â”€ buf.yaml               # buf mod initã§ç”Ÿæˆã€‚ã„ã˜ã‚‰ãªã„ã€‚
â”œâ”€â”€ cmd
â”‚   â””â”€â”€ connect-test
â”‚       â””â”€â”€ main.go        # ã‚µãƒ¼ãƒãƒ¼ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ frontend               # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€(è©³ç´°ã¯çœç•¥
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ greet          # è‡ªå‹•ç”Ÿæˆã§ä½œã£ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰
â”‚           â””â”€â”€ v1
â”‚               â”œâ”€â”€ greet_connectweb.ts
â”‚               â””â”€â”€ greet_pb.ts
â”œâ”€â”€ release.go             # é™çš„HTMLãƒãƒ³ãƒ‰ãƒ«ç”¨(github.com/shibukawa/frontend-goåˆ©ç”¨)
â”œâ”€â”€ gen                    # è‡ªå‹•ç”Ÿæˆã§ä½œã£ãŸã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰
â”‚   â””â”€â”€ greet
â”‚       â””â”€â”€ v1
â”‚           â”œâ”€â”€ greet.pb.go
â”‚           â””â”€â”€ greetv1connect
â”‚               â””â”€â”€ greet.connect.go
â”œâ”€â”€ generate.go            # go generateã‚’å®šç¾©ã—ãŸã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ greet                  # protobufå®šç¾©
â”‚   â””â”€â”€ v1
â”‚       â””â”€â”€ greet.proto
â””â”€â”€ server.go              # ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆã“ã“ã§ã¯connect-test)ã‚’ä½œã‚Šã€æ¬¡ã®ã‚ˆã†ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã¾ã—ãŸã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯Solid.jsã‚’ä½¿ã£ã¦ã¾ã™ã€‚

```sh
$ mkdir connect-test
$ go mod init connecttest
$ npx degit solidjs/templates/ts frontend # Solid.jsã§frontendä½œæˆ
```

å¿…è¦ãªãƒ„ãƒ¼ãƒ«é¡ã‚’å…¥ã‚Œã¾ã™ã€‚ãƒ¡ã‚¤ãƒ³ã®bufã¨Goç”¨ã®ãƒ„ãƒ¼ãƒ«ã¯Goè£½ãªã®ã§go installã§å…¥ã‚Œã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ–¹ã¯npmã§é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã®ã§npm installã—ã¾ã™ã€‚

```sh
$ go install github.com/bufbuild/buf/cmd/buf@latest
$ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
$ go install github.com/bufbuild/connect-go/cmd/protoc-gen-connect-go@latest
$ cd frontend
$ npm install --save-dev bufbuild/protoc-gen-connect-web bufbuild/protoc-gen-es
```

# gRPCã®å®šç¾©ä½œæˆ

ã“ã“ã§ã¯ã€connect-goã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ã¨ã‚Šã‚ãˆãšãã®ã¾ã¾åˆ©ç”¨ã—ã¾ã—ãŸã€‚go_packageã ã‘ã¯go modã§è¨­å®šã—ãŸãƒ«ãƒ¼ãƒˆã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ã˜ã¾ã‚Šã«ãªã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚

```java greet/v1/greet.proto
syntax = "proto3";

package greet.v1;

option go_package = "connecttest/gen/greet/v1;greetv1";

message GreetRequest {
  string name = 1;
}

message GreetResponse {
  string greeting = 1;
}

service GreetService {
  rpc Greet(GreetRequest) returns (GreetResponse) {}
}
```

`buf mod init`ã‚’å®Ÿè¡Œã—ã¦`buf.yaml`ã‚’ç”Ÿæˆã—ãŸã‚ã¨ã¯ã€`buf.gen.yaml`ã‚’è‡ªåˆ†ã§ä½œæˆã—ã¾ã™ã€‚ä¸ŠäºŒã¤ã¯Goã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®ãŸã‚ã®connect-goã®ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ã§ã™ãŒã€ä¸‹ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨ã®è¨­å®šã§ã™ã€‚å‡ºåŠ›å…ˆã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```yaml buf.gen.yaml
version: v1
plugins:
  - name: go
    out: gen
    opt: paths=source_relative
  - name: connect-go
    out: gen
    opt: paths=source_relative
  - name: es
    path: ./frontend/node_modules/.bin/protoc-gen-es
    out: frontend/src
    opt: target=ts
  - name: connect-web
    path: ./frontend/node_modules/.bin/protoc-gen-connect-web
    out: frontend/src
    opt: target=ts
```

ã‚ã¨ã¯`buf generate`ã§ã‚µãƒ¼ãƒãƒ¼ã¨ãƒ•ãƒ­ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

# APIã‚µãƒ¼ãƒãƒ¼ã®ä¸­èº«ã®å®Ÿè£…

ä¸­èº«ã¯connect-goã®ã‚µãƒ³ãƒ—ãƒ«ã¨ã»ã¼åŒã˜ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ããŸ`name`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ–‡å­—åˆ—ã‚’ä½œã£ã¦è¿”ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

```go server.go
package connecttest

import (
	"context"
	"fmt"

	greetv1 "connecttest/gen/greet/v1"

	"github.com/bufbuild/connect-go"
)

type GreetServer struct{}

func (s *GreetServer) Greet(
	ctx context.Context,
	req *connect.Request[greetv1.GreetRequest],
) (*connect.Response[greetv1.GreetResponse], error) {
	res := connect.NewResponse(&greetv1.GreetResponse{
		Greeting: fmt.Sprintf("Hello, %s!", req.Msg.Name),
	})
	return res, nil
}
```

ã“ã®ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¨ã—ã¦ç™»éŒ²ã—ã¦ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```go cmd/connect-test/main.go
package main

import (
	"context"
	"fmt"
	"log"
	"net/http"
	"os"
	"os/signal"
	"time"

	"github.com/shibukawa/frontend-go"
	"golang.org/x/net/http2"
	"golang.org/x/net/http2/h2c"

	"connecttest"
	"connecttest/gen/greet/v1/greetv1connect"
)

func main() {
	ctx, stop := signal.NotifyContext(context.Background(), os.Interrupt)
	defer stop()

	greeter := &connecttest.GreetServer{}
	mux := http.NewServeMux()
	path, handler := greetv1connect.NewGreetServiceHandler(greeter)
	mux.Handle(path, handler)
	mux.Handle("/", frontend.MustNewSPAHandler(ctx)) // ğŸ™

	server := &http.Server{
		Addr:    ":8888",
		Handler: h2c.NewHandler(mux, &http2.Server{}),
	}

	go func() {
		<-ctx.Done()
		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
		defer cancel()
		server.Shutdown(ctx)
	}()
	fmt.Println("start receiving at :8888")
	log.Fatal(server.ListenAndServe())
}
```

é–‹ç™ºæ™‚ã«ã¯è£ã§frontendãƒ•ã‚©ãƒ«ãƒ€ã§npm run devã—ã¦é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§SPAã‚’è¡¨ç¤ºã—ã¦ã€ãƒªãƒªãƒ¼ã‚¹æ™‚ã«ã¯go embedã§å–ã‚Šè¾¼ã‚“ã æˆæœç‰©ã®HTML/CSS/JSã‚’ä½¿ã£ã¦è¡¨ç¤ºã—ã¦ã‚ã’ã‚‹([go:embedç´¹ä»‹è¨˜äº‹ã§ã‚„ã£ã¦ã„ã‚‹ã®ã¨åŒç­‰](https://future-architect.github.io/articles/20210408/))ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®[github.com/shibukawa/frontend-go](https://github.com/shibukawa/frontend-go)ã¨ã„ã†ã®ã‚’ã“ã®å‰ä½œã£ãŸã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã¤ã„ã§ã«ãã‚Œã®è¨­å®šç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚‚ä½œæˆã—ã¾ã™ãŒã€ãƒªãƒãƒ—ãƒ­ã„ã‚‰ãªã„ã‚ˆã€ã¨ã„ã†ã“ã¨ã§ã‚ã‚Œã°ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨â†‘ã®ğŸ™ã®è¡Œã‚’æ¶ˆã—ã¦ãã ã•ã„ã€‚

```go frontend.go
//go:build release

package connecttest

import (
	"embed"

	"github.com/shibukawa/frontend-go"
)

//go:embed frontend/dist/*
var asset embed.FS

func init() {
	frontend.SetFrontAsset(asset, frontend.Opt{
		FrameworkType: frontend.SolidJS,
	})
}
```

ã“ã‚Œã§ã‚µãƒ¼ãƒãƒ¼ã¯å®Œæˆã§ã™ã€‚

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä½œæˆ

connect-webã§ä½œæˆã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ã¾ãšãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã€ãã‚Œã‚’æ¸¡ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã‚ã¨ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¹ã°ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã¾ã™ã€‚

```ts
import {
  createConnectTransport,
  createPromiseClient,
} from "@bufbuild/connect-web";

import {
  GreetService
} from "./greet/v1/greet_connectweb"

// ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆä½œæˆ
const transport = createConnectTransport({
  baseUrl: "/",
});

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
const client = createPromiseClient(GreetService, transport);

// ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
const res = await client.greet({name: "åå‰"});
```

ã“ã®çŠ¶æ…‹ã§ã¯ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®connectãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã®é€šä¿¡ã«ãªã‚Šã¾ã™ã€‚ãªãŠã€``createConnectTransport()``ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã€ãƒã‚¤ãƒŠãƒªå½¢å¼ãŒé¸ã¹ãŸã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã®è¨­å®šãŒã§ããŸã‚Šã€ã„ã‚ã„ã‚ã§ãã¾ã™ã€‚ãªãŠã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚’å¤–ã—ãŸå ´åˆã¯`baseUrl`ã¯`http://localhost:3000`ã¨ã‹ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨`createGrpcWebTransport()`ã¨ã„ã†ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆä½œæˆã®ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•°ã‚‚ã‚ã‚Šã€ã“ã‚Œã‚’ä½¿ã†ã¨ç´”æ­£ã®gRPC-Webãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®é€šä¿¡ã«ãªã£ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

ã¾ãŸã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ã„ã¾ã©ãä½¿ã†ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚‚ã®ã‚’ä½œæˆã™ã‚‹`createCallbackClient()`ã‚‚ã‚ã‚Šã¾ã™ã€‚

æœ€çµ‚ç³»ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚Solid.jsã§ã¯ã‚µãƒ¼ãƒãƒ¼é€šä¿¡ã¯`createResource()`ã§ãƒ©ãƒƒãƒ—ã—ã¦ä½¿ã„ã¾ã™ãŒã€ã“ã®ä¸­ã§ã¯asyncé–¢æ•°ã‚’æ¸¡ã›ã°è‰¯ã„ã®ã§ã€connect-webã§ç”Ÿæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã¯ã°ã£ã¡ã‚Šæ´»ç”¨ã§ãã¾ã™ã€‚

```tsx App.tsx
import {
  createSignal,
  createResource,
  Component,
} from 'solid-js';

(ã“ã“ã«ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã‚‹)

async function greeter(name: string) {
  return client.greet({name});
}

const App: Component = () => {
  const [name, setName] = createSignal("bob");
  const [greet] = createResource(name, greeter);

  return (
    <div class={styles.App}>
      <header class={styles.header}>
        <input
          placeholder="åå‰ã‚’å…¥ã‚Œã¦ã­"
          onInput={(e) => setName(e.currentTarget.value)}
        />
        <p>greeting: {greet()?.greeting}</p>
      </header>
    </div>
  );
};

export default App;
```

<img src="/images/20220819a/image.png" alt="image.png" width="1200" height="792" loading="lazy">

ã“ã‚Œã ã‘ã§ã€åå‰ã‚’å…¥ã‚ŒãŸã‚‰ã‚µãƒ¼ãƒãƒ¼ã§æŒ¨æ‹¶æ–‡ã‚’ç”Ÿæˆã—ã¦è¿”ã—ã€ãã‚Œã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã§ãã¾ã—ãŸã€‚

ä»Šå›ã®ä¾‹ã¯ä½¿ã£ã¦ã¿ãŸã‹ã£ãŸã®ã§Solid.jsã‚’ä½¿ã„ã¾ã—ãŸãŒã€Reactãƒ¦ãƒ¼ã‚¶ãƒ¼ã§`useSWR()`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãªã‚‰ãŸã¶ã‚“ã“ã†ã™ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚SWRã¯æœ€åˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæ–‡å­—åˆ—ã‹æ–‡å­—åˆ—ã®é…åˆ—ï¼‰ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€`fetcher`ã®ä¸­ã§ã¯ä¸è¦ãª(ç”Ÿæˆã‚³ãƒ¼ãƒ‰ãŒæŒã£ã¦ãã‚Œã¦ã„ã‚‹)ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰ã‚’ã‚ãˆã¦`useSWR()`ã®å¼•æ•°ã«å…¥ã‚Œã¦ã„ã¾ã™ã€‚

```ts
async function fetcher(key: string, name: string) {
    return client.greet({name});
}

const { data, error } = useSWR([GreetService.methods.greet.name, name], fetcher)
```

# ã¾ã¨ã‚

connect-goã®ã¨ãã‚‚ãã†ã§ã—ãŸãŒã€ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã®åˆ†é‡ãŒã‹ãªã‚Šå°‘ãªãã¦ç†è§£ã—ã‚„ã™ã„ã®ã§ã€ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«è²¬ä»»ã‚’æŒã£ã¦ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã®ãŒã‚„ã‚Šã‚„ã™ãã†ã§ã„ã„ã§ã™ã­ã€‚ã¾ãŸã€gRPCã¯OpenAPIã®yamlã‚ˆã‚Šã‚‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«æ›¸ã‘ã‚‹ã—ã€ã‚‚ã¡ã‚ã‚“ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚‚ã‚µãƒ¼ãƒãƒ¼ã‚‚å‹ãƒã‚§ãƒƒã‚¯ãŒã°ã£ã¡ã‚ŠåŠ¹ã„ã¦ã„ã„æ„Ÿã˜ã§ã™ã€‚ã“ã‚Œã§ã‚ã‚Œã°ã€OpenAPIã®ã¨ãã¿ãŸã„ã«ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã„ã˜ã‚Šå‡ºã—ãŸã‚Šã€ã¨ã„ã†ã®ã‚‚å½“é¢ã¯ä¸è¦ãªæ°—ãŒã—ã¾ã™ã€‚



