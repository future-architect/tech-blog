---
title: "Cypressã§ãƒ†ã‚¹ãƒˆå¯èƒ½ãªãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè£…"
date: 2021/08/06 00:00:00
postid: a
tag:
  - Cypress
  - React
  - Frontend
  - TailwindCSS
category:
  - Programming
thumbnail: /images/20210806a/thumbnail.png
author: æ¾å·å–œè¦
lede: "ãŠä»•äº‹ã‚³ãƒ¼ãƒ‰ã§ã€ã€ŒCypressã§é ‘å¼µã£ãŸã‘ã©ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®ãƒ†ã‚¹ãƒˆãŒã§ããªã„ã€ã¨ã„ã†ç›¸è«‡ã‚’å—ã‘ã¾ã—ãŸã€‚åƒ•ã‚‚è©¦è¡ŒéŒ¯èª¤ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ã©ã†ã‚‚ã†ã¾ãã„ã‹ãšãƒ»ãƒ»ãƒ»Cypressã¨ã‹ã®E2Eãƒ†ã‚¹ãƒˆã¯ã€å®Œå…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚ã‘ã§ã¯ãªãã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã¨ãã«ç™ºç”Ÿã™ã‚‹ã§ã‚ã‚ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ“¬ä¼¼çš„ã«ä½œã£ã¦æŠ•ã’ã¦ã„ã‚‹ã«ã™ãã¾ã›ã‚“ã€‚å®Ÿéš›ã«ç™ºç”Ÿã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚ˆã‚Šã‚‚å°‘ãªã„ã§ã™ã€‚ä¾‹ãˆã°..."
---

ãŠä»•äº‹ã‚³ãƒ¼ãƒ‰ã§ã€ã€ŒCypressã§é ‘å¼µã£ãŸã‘ã©ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®ãƒ†ã‚¹ãƒˆãŒã§ããªã„ã€ã¨ã„ã†ç›¸è«‡ã‚’å—ã‘ã¾ã—ãŸã€‚åƒ•ã‚‚è©¦è¡ŒéŒ¯èª¤ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ã©ã†ã‚‚ã†ã¾ãã„ã‹ãšãƒ»ãƒ»ãƒ»

# ãªãœã†ã¾ãã„ã‹ãªã„ã®ã‹

Cypressã¨ã‹ã®E2Eãƒ†ã‚¹ãƒˆã¯ã€å®Œå…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚ã‘ã§ã¯ãªãã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã¨ãã«ç™ºç”Ÿã™ã‚‹ã§ã‚ã‚ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ“¬ä¼¼çš„ã«ä½œã£ã¦æŠ•ã’ã¦ã„ã‚‹ã«ã™ãã¾ã›ã‚“ã€‚å®Ÿéš›ã«ç™ºç”Ÿã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚ˆã‚Šã‚‚å°‘ãªã„ã§ã™ã€‚ä¾‹ãˆã°ã€ãƒã‚¦ã‚¹ãŒç§»å‹•ã™ã‚‹ã¨ã€ãƒã‚¦ã‚¹ã®ã—ãŸã®è¦ç´ ã®mouseover/mouseleaveã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ãã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãƒ†ã‚¹ãƒˆã§ã¯ãã†ã„ã†ã“ã¨ã¯ã›ãšã€å¿…è¦ãªè¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã¨ã‹ã€inputã¸ã®ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã¨ã‹å¿…è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ã‚’ç™ºè¡Œã—ã¾ã™ã€‚

ãŠä»•äº‹ã‚³ãƒ¼ãƒ‰ã§ä½¿ã£ã¦ã„ãŸã®ã¯ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã•ã¾ã–ã¾ãªãƒã‚¦ã‚¹ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’å®Ÿç¾ã—ã¦ãã‚Œã‚‹ä¾¿åˆ©ãã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã­ã€‚

https://use-gesture.netlify.app/

ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®ã‚µãƒ³ãƒ—ãƒ«ã¯[ã“ã¡ã‚‰](https://codesandbox.io/s/fh8r8?file=/src/index.js)ã«ã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’è¦‹ã‚‹ã¨ã€ãƒã‚¦ã‚¹ã®åº§æ¨™ã‚’ã¨ã£ã¦ã€ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚ãã—ã¦ã€ãã‚Œã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«æŠ•ã’è¾¼ã‚“ã§ã„ã‚‹ã‚ˆã†ã§ã™ã­ã€‚ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«é€£ç¶šçš„ã«é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã¦ã„ã¾ã™ã€‚

```js
  const bind = useDrag(({ args: [originalIndex], active, movement: [, y] }) => {
    const curIndex = order.current.indexOf(originalIndex)
    const curRow = clamp(Math.round((curIndex * 100 + y) / 100), 0, items.length - 1)
    const newOrder = swap(order.current, curIndex, curRow)
    // Feed springs new style data, they'll animate the view without causing a single render
    setSprings(fn(newOrder, active, originalIndex, curIndex, y))
    if (!active) order.current = newOrder
  })
```

ã“ã†ã„ã†ã®ã¯E2Eãƒ†ã‚¹ãƒˆã§ã¯ã‚„ã‚Šã«ãã„ã§ã™ã­ã€‚

# E2Eãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—

å®Ÿè£…ã—ã¦ã¿ãŸã‚µãƒ³ãƒ—ãƒ«ãŒã“ã‚Œã§ã™ã€‚3ã¤ã®è¦ç´ ã®ãƒªã‚¹ãƒˆã‚’ä¸¦ã¹æ›¿ãˆã—ã¾ã™ã€‚

<img src="/images/20210806a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2021-07-29_18.38.23.png" alt="ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒªã‚¹ãƒˆä¸¦ã³æ›¿ãˆç”»é¢" width="1200" height="611" loading="lazy">

E2Eãƒ†ã‚¹ãƒˆã‚‚é€šã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã®å®Ÿç¾æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚


<img src="/images/20210806a/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2021-07-29_18.39.50.png" alt="ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒªã‚¹ãƒˆä¸¦ã³æ›¿ãˆç”»é¢" width="1200" height="717" loading="lazy">


ã¾ãšãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å´ã‹ã‚‰ã€‚ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã¯ã€ã€Œãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹è¦ç´ ã€ã¨ã€ã€Œãã‚Œã‚’è½ã¨ã—ãŸè¦ç´ ã€ãŒæ˜ç¢ºã§ã‚ã‚‹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚ã“ã®å ´åˆã€data-itemå±æ€§ã®ã¤ã„ãŸè¦ç´ ãŒãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹èµ¤ã„å››è§’ã€data-targetã¯ãƒ‰ãƒ­ãƒƒãƒ—å…ˆã§ã€å„è¦ç´ ã®é–“ã¨ã€ãƒªã‚¹ãƒˆã®å…ˆé ­ã€æœ«å°¾ã«4ã¤ã‚ã‚Šã¾ã™ã€‚

```js
context("drag and drop", () => {
  beforeEach(() => {
    cy.visit("http://localhost:3000/");
  });

  it("can drag and drop items", () => {
    cy.get("[data-item='B']").trigger("dragstart").trigger("dragleave");
    cy.get("[data-target='0']")
      .trigger("dragenter")
      .trigger("dragover")
      .trigger("drop")
      .trigger("dragend");
    cy.get(".item:first").contains("B");
  });
});
```

create-react-appã§ã€TypeScriptã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚ãã®å¾Œã€Tailwind CSSã‚’è¨­å®šã—ãŸçŠ¶æ…‹ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚èª¬æ˜ã¯å…¬å¼ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã¡ã‚‡ã£ã¨é•·ããªã‚‹ã®ã§æœ¬ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã§ã¯çœç•¥ã—ã¾ã™ã€‚

* [Create React App: Adding TypeScript](https://create-react-app.dev/docs/adding-typescript/)
* [Install Tailwind CSS with Create React App](https://tailwindcss.com/docs/guides/create-react-app)

ã„ããªã‚Šå®Œæˆå½¢ã ã¨é•·ã™ãã‚‹ã®ã§ã€ã¾ãšã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè£…ã™ã‚‹å‰ã®çŠ¶æ…‹ã‚’ãŠè¦‹ã›ã—ã¾ã™ã€‚ListãŒè¦ªã®è¦ç´ ã€ElemãŒãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹è¦ç´ ã€TargetãŒãƒ‰ãƒ­ãƒƒãƒ—å…ˆã®è¦ç´ ã§ã€Listã®ä¸­ã§ã¯`<Target><Elem><Target>...<Elem><Target>`ã¨äº’ã„é•ã„ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```js index.tsx
import React, { useState } from "react";
import ReactDOM from "react-dom";
import "./index.css";

function Elem(props: {
  label: string;
  index: number;
}) {
  return (
    <div
      data-item={props.label}
      draggable="true"
      className={`item flex-initial border-4 border-red-400 p-4 rounded cursor-move`}
    >
      {props.label}
    </div>
  );
}

function Target(props: { index: number }) {
  return (
    <span
      className={`target flex-initial p-2`}
      data-target={props.index}
    ></span>
  );
}

function List(props: {}) {
  const [items, setItems] = useState(["A", "B", "C"]);

  const tags = [<Target index={0} onDrop={onDrop} />];
  for (const [i, item] of items.entries()) {
    tags.push(
      <Elem label={item} index={i} onDrag={onDrag} />,
      <Target index={i + 1} onDrop={onDrop} />
    );
  }
  return (
    <div className="flex border-2 border-blue-400 p-4 rounded">{tags}</div>
  );
}

ReactDOM.render(
  <React.StrictMode>
    <List />
  </React.StrictMode>,
  document.getElementById("root")
);
```

ä¸€ã¤ãšã¤å®Œæˆã•ã›ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãšã€ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªè¦ç´ ã¯ã€onDragStart/onDragEndã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¾ã™ã€‚onDragStartã§ã€è‡ªåˆ†ãŒãƒ‰ãƒ©ãƒƒã‚°ã•ã‚Œã¦ã„ã‚‹ã‚ˆã€ã¨ã„ã†ã“ã¨ã‚’è¦ªã«ä¼ãˆã¾ã™ã€‚ãã‚Œä»¥å¤–ã¯è¦‹ãŸç›®ã®é€æ˜åº¦ã‚’å¤‰ãˆã‚‹ãã‚‰ã„ã§ã™ã­ã€‚ã“ã“ã§ã¯åŠé€æ˜ã«ã—ã¦ã„ã¾ã™ãŒã€å®Œå…¨ã«é€æ˜ã«ã—ã¦ã—ã¾ã£ã¦å¹…ã‚‚ã‚¼ãƒ­ã«ã—ã¦ã—ã¾ã†ã¨ã€react-use-gestureã®ã‚µãƒ³ãƒ—ãƒ«ã¿ãŸã„ãªã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒªã‚¹ãƒˆãŒæ›¸ãå¤‰ã‚ã£ã¦å‹•ã„ã¦ã„ã‚‹ã‚ˆã†ãªæ„Ÿã˜ã«ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

```js index.tsx
function Elem(props: {
  label: string;
  index: number;
  onDrag: (index: number) => void;
}) {
  const [dragging, setDragging] = useState(false);
  const dragStart = useCallback(() => {
    setDragging(true);
    props.onDrag(props.index);
  }, [props]);
  const dragEnd = useCallback(() => {
    setDragging(false);
  }, []);
  return (
    <div
      data-item={props.label}
      draggable="true"
      className={`item flex-initial border-4 border-red-400 p-4 rounded cursor-move ${
        dragging ? "opacity-40" : ""
      }`}
      onDragStart={dragStart}
      onDragEnd={dragEnd}
    >
      {props.label}
    </div>
  );
}
```

æ¬¡ã¯ãƒ‰ãƒ­ãƒƒãƒ—å…ˆã§ã™ã€‚onDragOver/onDragEnter/onDragLeave/onDropã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã‚Œã‚‚onDropã§è¦ªã®ãƒªã‚¹ãƒˆã«è‡ªåˆ†ã«ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã“ã¨ã‚’ä¼ãˆã¾ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯Tailwind CSSã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å±æ€§ï¼ˆp-2, p-6)ã§é›‘ã«ç©ºé–“ã‚’åºƒã’ã¦ã„ã¾ã™ãŒã€å…ƒã®è¦ç´ ã®ã‚µã‚¤ã‚ºï¼‹è¦ç´ é–“ã®éš™é–“x2ã®å¹…ã«ãã¡ã‚“ã¨è¨ˆç®—ã—ã¦è¡¨ç¤ºã—ã¦ã‚ã’ã‚‹ã¨ã€ãã‚Œã„ãªè¦‹ãŸç›®ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¤ã„ã§ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã®å¹…ã«å¤‰ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã’ã‚‹ã¨ã‚‚ã£ã¨è‰¯ã•ãã†ã€‚

```js
function Target(props: { index: number; onDrop: (index: number) => void }) {
  const [over, setOver] = useState(false);
  const dragOver = useCallback((e: DragEvent) => {
    e.preventDefault();
  }, []);
  const dragEnter = useCallback(() => {
    setOver(true);
  }, []);
  const dragLeave = useCallback(() => {
    setOver(false);
  }, []);
  const drop = useCallback(
    (e: DragEvent) => {
      e.preventDefault();
      setOver(false);
      props.onDrop(props.index);
    },
    [props]
  );

  return (
    <span
      onDragOver={dragOver}
      onDragEnter={dragEnter}
      onDragLeave={dragLeave}
      onDrop={drop}
      className={`target flex-initial ${
        over ? " border-2 border-dotted border-red-200 p-6" : "p-2"
      }`}
      data-target={props.index}
    ></span>
  );
}
```

æœ€å¾ŒãŒè¦ªã®ãƒªã‚¹ãƒˆã§ã™ã€‚å­ä¾›ã®ã€Œãƒ‰ãƒ©ãƒƒã‚°ã•ã‚ŒãŸã‚ˆã€ã€Œãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã‚ˆã€æƒ…å ±ã‚’å—ã‘å–ã‚Šã€useEffectã§ä¸¦ã³æ›¿ãˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚


```js index.tsx
function List(props: {}) {
  const [items, setItems] = useState(["A", "B", "C"]);
  let [src, setSrc] = useState(-1);
  let [target, setTarget] = useState(-1);

  const onDrag = useCallback((index: number) => {
    setSrc(index);
    console.log(`ğŸ¥š onDrag ${index}`);
  }, []);

  const onDrop = useCallback((index: number) => {
    console.log(`ğŸ£ onDrop ${index}`);
    setTarget(index);
  }, []);

  useEffect(() => {
    if (src !== -1 && target !== -1) {
      setItems(swap(items, src, target));
    }
  }, [src, target]);

  const tags = [<Target index={0} onDrop={onDrop} />];
  for (const [i, item] of items.entries()) {
    tags.push(
      <Elem label={item} index={i} onDrag={onDrag} />,
      <Target index={i + 1} onDrop={onDrop} />
    );
  }
  return (
    <div className="flex border-2 border-blue-400 p-4 rounded">{tags}</div>
  );
}
```

ä¸¦ã³æ›¿ãˆã¯ã‚‚ã£ã¨åŠ¹ç‡ãŒã„ã„å®Ÿè£…ã¯ã‚ã‚Šã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšé›‘ã«ã€‚

```js
function swap(items: readonly string[], src: number, dest: number): string[] {
  if (src < dest) {
    dest--;
  }
  const srcItem = items[src];
  const tmp = [...items.slice(0, src), ...items.slice(src + 1)];
  switch (dest) {
    case tmp.length:
      tmp.push(srcItem);
      return tmp;
    case 0:
      return [srcItem, ...tmp];
    default:
      return [...tmp.slice(0, dest), srcItem, ...tmp.slice(dest)];
  }
}
```

æ»‘ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚‚ã†ã¡ã‚‡ã£ã¨CSSã‚’é ‘å¼µã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ãŒã€ã²ã¨ã¾ãšã“ã‚“ãªæ„Ÿã˜ã§Cypressã§ãƒ†ã‚¹ãƒˆå¯èƒ½ãªãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚

å®Ÿéš›ã«ã“ã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã¨ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ãªãƒ­ã‚¸ãƒƒã‚¯ãŒã¹ã£ãŸã‚Šãªã®ã§ã€å¿…è¦ãªã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®éŒ¬æˆã¨ã‹ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã¾ã¨ã‚ã‚‹ã¨ã‹ã€ã‚ã‚‹ã„ã¯ã“ã“ã®Listã¨Targetç›¸å½“ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ã—ã¦ã€å­ä¾›ã®è¦ç´ ã‚’props.childrenã‹ä½•ã‹ã§ã‚‚ã‚‰ã£ãŸã®ã‚’ã‚½ãƒ¼ãƒˆã—ã¦çµæœã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã‚ˆã†ãªSortableListã¿ãŸã„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã™ã‚‹ã‹ã€ãã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
