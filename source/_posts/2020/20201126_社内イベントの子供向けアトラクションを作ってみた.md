---
title: "塗り絵の魚がすいすい泳ぐ？ ～子ども向けアトラクションを作ってみた～"
date: 2020/11/26 00:00:00
postid: ""
tag:
  - RealSense
  - Processing
category:
  - IoT
thumbnail: /images/20201126/thumbnail.jpg
author: 山本力世
lede: "当社ではBPYというイベントの後に、YEPという社員の家族も参加する懇親会を行います。2020年はあいにくの情勢で開催はできませんが、2019年はお子様向けにちょっとしたアトラクションを準備して、大好評だったので制作秘話をお伝えしようかと思います。"
---

# はじめに

当社では、年末に社内イベントとして、BPY（Best Project of the Year）と YEP(Year End Party) があり、YEPは社員だけでなくそのご家族も参加されます。

* BPYとYEPについては[未来報のこちらの記事](https://note.future.co.jp/n/n7b0e5de1b2bc)をご覧ください。

BPYはかなり大掛かりなイベントで、想像を超える完成度で規模も非常に大きいです。2019年以前では会場は[ANAインターコンチネンタルホテル東京](https://anaintercontinental-tokyo.jp/)の大宴会場に溢れんばかりの人で、ご家族合わせて1000名以上参加されていたのではないかと思います。

2020年もそろそろBPY/YEPの季節となってきており、社内もその準備で慌ただしいです。一方でコロナ禍の影響でBPYはリモートを活用して密を防ぐ対応を、YEPについては開催が見送られてしまいました。代わりと言ってはなんですが、2019年のYEPで子ども向けのアトラクションを社内有志で制作したお話をしたいと思います。

# 制作したもの

名付けて、「フューチャーアクアリウム」🐟🐠🐡🐙🐚です！ 脳の発育に良いとされる塗り絵と、ITを組み合わせたイノベーションです。アトラクションは食事に飽きたお子様がすぐ時間を潰せるようにという考えで大宴会場前のスペースに設置しました。

<img src="/images/20201126/top.jpg" loading="lazy">

正面から見るとこんな感じです。

<img src="/images/20201126/screen.jpg" loading="lazy">


アトラクションの流れとしては以下です。

1. まず、子供たちに生き物の塗り絵をしてもらいます
    * 塗り絵はお魚さんをたくさん用意しました
<img src="/images/20201126/nurie_template.png" loading="lazy">
2. 書いてもらった絵をカメラで取り込みます
<img src="/images/20201126/nurie.jpg" loading="lazy">
3. その取り込んだ塗り絵の画像をプロジェクタで映し出したスクリーン（アクリル板）上にアニメーション付きで表示します
4. スクリーン上の任意の場所をタッチするとその位置を深度センサで検知し、生き物がその部分によってくるように移動させます
<img src="/images/20201126/touch.jpg" loading="lazy">
    * そのままだと、投入された生き物で溢れかえってしまうので、ある程度増えたら、人間に釣られて消える仕組みも組み込みました。


自分の書いた絵がすぐに画面上に表示され、気持ちよさそうに泳ぐため、お子さまからは大好評でした。もちろん社員のお父さん・お母さんにも好評でした♪


# 制作の裏側

## スケジュールと体制

開発期間は通常業務を行いながらの1ヶ月弱という、結構、タイトなスケジュールでした。そうです。ちょうど2019年の11月中旬（この記事が公開される頃）に、YEPの企画チームから依頼を受け、有志を募り開発をスタートさせたのでした。

画像などのコンテンツ担当3人、アプリの開発担当3人のチームで開発しました。

## ハードウェア構成


ハードウェアの構成は、PC([IntelのNUC](https://www.intel.co.jp/content/www/jp/ja/products/boards-kits/nuc/kits/nuc8i5bek.html))に4Kプロジェクタ2台、深度センサ([IntelのRealSense](https://www.intelrealsense.com/depth-camera-d435i/))1台、USBカメラ1台、ポータブルモニタ1台を接続したものを２セット準備しました。

<img src="/images/20201126/hardware_structure.png" loading="lazy">

楽屋裏はこんな形でした。

<img src="/images/20201126/back.jpg" loading="lazy">

正面から見るとこういう感じに見えます。お魚さんがいないと寂しい感じです。

<img src="/images/20201126/monitor.jpg" loading="lazy">

4Kプロジェクタでスクリーン（アクリル板）に塗り絵の魚たちを表示し、指でタッチすると移動させたいので、イベントを拾うためRealSenseの深度センサを利用しています。

<img src="/images/20201126/sensor.png" loading="lazy">

USBカメラは塗り絵の撮影用です。


## ソフトウェア構成

ソフトウェアの開発は[Processing](https://processing.org/)で行いました。Processingが初めてな開発者もいましたが、ProcessingはJavaがベースとなっている言語でその開発者は元ゲーム系のC/C++プログラマーだったので、比較的すぐにキャッチアップし実装することができました。

まずは、一人の開発者が生き物の移動とアニメーションの基本的な処理を先に実装し、その後、別の開発者が各処理を統合しやすくフレームワーク的な作りを取り入れた後、生き物の画像データの取り込み、背景のアニメーション、深度センサによる位置検出などの処理を３人の開発者で分担・並行して開発を進めました。

生き物のアニメーションに関しては、某有名狩りゲーの魚の動きを参考に特定方向に対して速度を与えて減衰させる手法を取り、また、進行方向が左右に切り替わる際の反転アニメーションについては、既存のライブラリが存在しなかったため始めから作り込みました。

生き物の画像データの取り込みに関しては、リアルタイムに取り込むため、内部で特定フォルダにおけるファイル追加イベントを監視し、非同期で画像を読み込みアプリに表示できるようにしています。

## 当日の様子

BPY/YEP当日が、我々にとってのリリース日です。子どもたちの笑顔のためにも失敗は許されません。

幸いなことに、ほぼ予定通りにアトラクションを開業・運営することができました。覚えている限りのトラブルは、本番の会場では開発時と照明環境が異なり、画像データの取り込みの際に切り抜き処理が少しうまくいかないことでした。それ自体はその場で微調整を行うことで、大きな問題にはなりませんでした。

## まとめ

塗り絵の魚がすいすい泳ぐ、「フューチャーアクアリウム」🐟🐠🐡🐙🐚の解説でした。

来年こそはコロナ禍が去って、よりパワーアップしたアトラクションが登場してくることを期待したいと思います。

社員の方で、こういった装置に興味がある方や、パワーアップさせたい方がいましたら山本まで連絡ください。
