title: "Firebaseã§ãŠæ‰‹è»½ï¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”»é¢ã‚’ã¤ãã‚‹"
date: 2020/08/19 00:00:00
postid: ""
tag:
  - React
  - TypeScript
  - Firebase
  - Frontend
  - å…¥é–€
category:
  - Infrastructure
thumbnail: /images/20200819/thumbnail.png
author: æŸæœ¨ç¥¥å­
featured: false
lede: "Firebaseã‚’ä½¿ã£ã¦ç”»é¢ã‚’é–‹ç™ºã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ä¸‹è¨˜ã‚’æœ€çŸ­çµŒè·¯ã§ä½œã£ã¦ã¿ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ‰ãƒŸãƒ³ã®äººãŒä½¿ã†ã‚ˆã†ãªãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”»é¢ã‚’æƒ³å®šã—ã¦ã€é™ã‚‰ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã¹ãã€èªè¨¼æ©Ÿèƒ½ã‚‚å…¥ã‚Œã¾ã—ãŸã€‚"
---
# ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ï¼2017å¹´9æœˆå…¥ç¤¾ã®æŸæœ¨ã§ã™ã€‚[å¤ä¼‘ã¿è‡ªç”±ç ”ç©¶é€£è¼‰](/articles/20200726/)13æ—¥ç›®ã®è¨˜äº‹ã§ã™ï¼ğŸ–ï¸

æ˜¨æ—¥ã¯[ã€å…¥é–€ã€‘ç§ã‚’è‹¦ã—ã‚ãŸDynamoDB](/articles/20200818/)ã¨ã„ã†èª­ã¿å¿œãˆãŸã£ã·ã‚Šã®è¨˜äº‹ã§ã—ãŸã€‚
ä»Šå›ã¯ã€Firebaseã‚’ä½¿ã£ã¦ç”»é¢ã‚’é–‹ç™ºã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# æœ¬è¨˜äº‹ã®ã‚´ãƒ¼ãƒ«

ä¸‹è¨˜ã‚’æœ€çŸ­çµŒè·¯ã§ä½œã£ã¦ã¿ã¾ã™ã€‚
ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ‰ãƒŸãƒ³ã®äººãŒä½¿ã†ã‚ˆã†ãªãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”»é¢ã‚’æƒ³å®šã—ã¦ã€é™ã‚‰ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã¹ãã€èªè¨¼æ©Ÿèƒ½ã‚‚å…¥ã‚Œã¾ã—ãŸã€‚

* TypescriptÃ—Reactã®ã‚¢ãƒ—ãƒªã‚’ç«‹ã¡ä¸Šã’ã‚‹
* Firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆFirestoreï¼‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã™ã‚‹
* Firebase Hostingã‚’ç”¨ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹
* Firestoreã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹
* Firebase Authenticationã§èªè¨¼ã™ã‚‹

# ç’°å¢ƒ

* macOS Catalina (v10.15.6)
* Node.js (v14.8.0)

# å®Ÿè·µ

### TypescriptÃ—Reactã®ã‚¢ãƒ—ãƒªã‚’ç«‹ã¡ä¸Šã’ã‚‹

ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é–“ã‚’åŠ‡çš„ã«å‰Šæ¸›ã§ãã‚‹`creat-react-app`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä»Šå›ã¯typescriptã§å®Ÿè£…ã—ãŸã„ã®ã§ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚`npm start`ã§ç”»é¢ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

```terminal ~
$ npx create-react-app summer-vacation --typescript
$ cd summer-vacation
$ npm start
```

![](/images/20200819/image.png)

### Firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆFirestoreï¼‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã™ã‚‹

ç¶šã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚
ã¾ãšã€Firebaseä¸Šã«è‡ªèº«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚Googleã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Œã°ã€èª°ã§ã‚‚Firebaseã‚’å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.firebase.google.com/u/0/?hl=ja)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã€ã‹ã‚‰æŒ‡ç¤ºã«æ²¿ã£ã¦è¨­å®šã‚’è¡Œã†ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆå®Œäº†ã§ã™ã€‚

æ¬¡ã«ã€ç”»é¢ã«è¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚
Firebaseã«ã¯Firestoreã¨Realtime Databaseã€ï¼’ã¤ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚é•ã„ã¯[ã“ã¡ã‚‰ã®è¨˜äº‹](https://techblog.kayac.com/rtdb-vs-firestore)ã«ã‚ã‹ã‚Šã‚„ã™ãæ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚ä»Šå›ã¯ç°¡æ˜“ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ãªã®ã§ã©ã¡ã‚‰ã§ã‚‚å•é¡Œãªã„ã§ã™ãŒã€åå‰ãŒã‹ã£ã“ã„ã„ã®ã§å‰è€…ã‚’ç”¨ã„ã¾ã™ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã½ã“ã½ã“ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã€æº–å‚™å®Œäº†ã§ã™ï¼
![](/images/20200819/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2020-08-18_23.31.40.png)

### Firebase Hostingã‚’ç”¨ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒç°¡å˜ã«ã§ãã‚‹ã¨è©±é¡Œã®Firebase Hostingã‚’ç”¨ã„ã¦ã€ä¸‹è¨˜æ‰‹é †ã§ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚

#### 1. Firebaseã«è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã‚’ç™»éŒ²ã™ã‚‹

ã¾ãšã¯ã€Firebaseã‹ã‚‰ã‚¢ãƒ—ãƒªãŒåˆ©ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æƒ…å ±ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰è¨­å®šç”»é¢ã«é·ç§»ã—ã€ã€Œã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã€ã®ä½œæ¥­ã‚’è¡Œã„ã¾ã™ã€‚ä»Šå›ã¯webç”»é¢ãªã®ã§ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«webã‚’é¸æŠã—ã€summer-vacationã®ã‚¢ãƒ—ãƒªåã§è¿½åŠ ã—ã¾ã™ã€‚è¨­å®šãŒå®Œäº†ã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ã€ã‚¢ãƒ—ãƒªã§ä½¿ç”¨ã™ã‚‹configæƒ…å ±ãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼
![](/images/20200819/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2020-08-18_23.29.57.png)

#### 2. ã‚¢ãƒ—ãƒªã«Firebaseã®è¨­å®šã‚’çµ„ã¿è¾¼ã‚€

2ã§å–å¾—ã—ãŸæƒ…å ±ã‚’ä½œæˆã—ãŸReactã®ã‚¢ãƒ—ãƒªã«ç´ä»˜ã‘ã¾ã™ã€‚ãŸã ã“ã®æƒ…å ±ã¯å…¬é–‹ã—ãŸããªã„ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚
create-react-appã«ã¯dotenvã®æ©Ÿèƒ½ã‚‚çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒã‚¸ãƒˆãƒªç›´ä¸‹ã«ä½œæˆã—ã€å…ˆã»ã©ã®æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚create-react-appã®ãƒ«ãƒ¼ãƒ«ã§ã€å¤‰æ•°ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«`REACT_APP_`ã‚’ä½¿ç”¨ã—ãªã„ã¨èªè­˜ã—ã¦ãã‚Œãªã„ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚è¨­å®šã‚’è¡Œã£ãŸå¾Œã¯ã€`npm start` ã‚’å†å®Ÿè¡Œã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ç›´ã—ã¾ã™ã€‚

ç¶šã„ã¦ã€firebaseã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```terminal ~/summer-vacation
$ npm install firebase --save
```

æœ€å¾Œã«Firebaseã¨ã®ç´ä»˜ã‘ã‚’è¡Œã„ã¾ã™ã€‚ã“ã“ã§è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚

```js firebase/index.js
import firebase from 'firebase';

const env = process.env;

export const firebaseConfig = {
    apiKey: env.REACT_APP_API_KEY,
    authDomain: env.REACT_APP_AUTH_DOMAIN,
    databaseURL: env.REACT_APP_DATABASE_URL,
    projectId: env.REACT_APP_PROJECT_ID,
    storageBucket: env.REACT_APP_STORAGE_BUCKET,
    messagingSenderId: env.REACT_APP_MESSAGING_SENDER_ID,
    appId: env.REACT_APP_APP_ID,
    measurementId: env.REACT_APP_MEASUREMENT_ID,
};

// Firebaseã‚’ç´ä»˜ã‘ã€åˆæœŸåŒ–
export const firebaseApp = firebase.initializeApp(firebaseConfig);

// Firestoreã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
export const firebaseStore = firebaseApp.firestore();

export default firebase;
```

#### 3. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

æœ€å¾Œã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/cli?hl=ja#mac-linux-npm)ã®æ‰‹é †ã«æ²¿ã£ã¦firebaseã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
ãƒ­ã‚°ã‚¤ãƒ³ã—ã€è‡ªèº«ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ç´ã¥ã‘ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’ç¢ºèªã™ã‚‹ã¨ã€å…ˆã»ã©ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼

```terminal ~/summer-vacation
$ npm install -g firebase-tools
$ firebase login
$ firebase projects:list
âœ” Preparing the list of your Firebase projects
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Project Display Name â”‚ Project ID            â”‚ Project Number â”‚ Resource Location ID â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ summer-vacation      â”‚ summer-vacation-xxxxx â”‚ xxxxxxxxxxxx   â”‚ asia-northeast1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

firebaseã‚³ãƒãƒ³ãƒ‰ã§åˆæœŸåŒ–ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨å¯¾è©±å¼ã§è«¸ã€…ã®è¨­å®šã‚’è¡Œãˆã¾ã™ã€‚

```terminal ~/summer-vacation
$ firebase init
...
âœ”  Firebase initialization complete!
```

ä»Šå›ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã®ã¯ä¸‹è¨˜é …ç›®ã§ã™ã€‚
ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œæ™‚ã«react-scriptsã‚³ãƒãƒ³ãƒ‰ãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã®ãŒ`build`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã®ã§ã€public directoryã¯`build`é…ä¸‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚

* summer-vactionã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨
* Hostingã®ã‚µãƒ¼ãƒ“ã‚¹ã€Cloud Firestoreã‚’åˆ©ç”¨
* public directoryã« `build`ã‚’æŒ‡å®š
* SPAã¨ã—ã¦åˆ©ç”¨

ã“ã®çŠ¶æ…‹ã§ãƒ“ãƒ«ãƒ‰ã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
ã‚³ãƒãƒ³ãƒ‰ã«è¡¨ç¤ºã•ã‚ŒãŸURLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼

```terminal ~/summer-vacation
$ npm run build
$ firebase deploy
...
âœ”  Deploy complete!
Hosting URL: https://example.web.app
```
![](/images/20200819/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2020-08-18_23.19.09.png)


### Firestoreã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹

ã„ã‚ˆã„ã‚ˆFirestoreã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
å…ˆã»ã©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸfirebaseã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€Firestoreã«æ ¼ç´ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åç§°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
React Hooksã®`useEffect`ã‚’ä½¿ã£ã¦ã€åˆæœŸæç”»å¾Œã«ãƒ‡ãƒ¼ã‚¿å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```ts App.tsx
  const [loading, setLoading] = useState(true);
  const [users, setUsers] = useState<firebase.firestore.DocumentData[]>([]);

  useEffect(() => {
    const searchUsers = async() => {
      // Firestoreã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã€‚ä»Šå›ã¯å…¨é‡ã‚’æ¤œç´¢
      const res = await fireStore.collection('users').get();
      if (res.empty) return [];
      const userList: firebase.firestore.DocumentData[] = [];
      // DocumentDataå‹ã«ã¯mapãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€forEachã®ãƒ«ãƒ¼ãƒ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥
      res.forEach(doc => {
          userList.push(doc.data());
      })
      setUsers(userList);
    }

    searchUsers();
    setLoading(false);
}, []);

```

ãªã‚“ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ„ã¿è¾¼ã¿ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã ã‘ã§ã€ç°¡å˜ã«Firestoreã¨ã®ç–é€šã€ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Ÿç¾ã§ãã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã¨ã£ã¦ã‚‚ãŠæ‰‹è»½ã§ã™ã­ï¼

![](/images/20200819/image_2.png)


### Firebase Authenticationã§èªè¨¼ã™ã‚‹

æœ€å¾Œã«ã€è‡ªèº«ä»¥å¤–ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ä»•çµ„ã¿ã‚‚è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚
Firebaseã®èªè¨¼æ©Ÿèƒ½ã‚’ç°¡å˜ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å®Ÿè£…ã§ãã‚‹`react-firebaseui`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

### 1. Firebase Authenticationã§èªè¨¼æ–¹æ³•ã‚’ç™»éŒ²ã™ã‚‹

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®è¨­å®šç”»é¢ã‹ã‚‰ã€ã€Œãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•ã‚’è¨­å®šã€ã—ã¾ã™ã€‚
![](/images/20200819/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2020-08-18_23.20.20.png)

ç§ã¯Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®èªè¨¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
![](/images/20200819/image_3.png)

### ï¼’. ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…ã™ã‚‹

æœ€åˆã«ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã¨ãªã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç’°å¢ƒå¤‰æ•°ã«è¿½åŠ ã—ã¾ã™ã€‚

```text .env
REACT_APP_VALID_MAIL_ADDRESSES=firebaseapp@example.com
```

æ¬¡ã«ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚èªè¨¼ç”»é¢ã‚’ç”¨æ„ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã€æ‰‹é–“ã‚’çœãã¾ã™ã€‚

```terminal ~/summer-vacation
$ npm install --save react-firebaseui
```

å…ˆã»ã©ã¨åŒã˜App.tsxã«å®Ÿè£…ã‚’çµ„ã¿è¾¼ã¿ã¾ã™ã€‚

```ts App.tsx
const [myAccount, setMyAccount] = useState<firebase.User>();

useEffect(() => {
    const searchUsers = async() => {
      ...
    }

    firebase.auth().onAuthStateChanged((user) => {
      setLoading(false);
      if (!user) return;
      if (user.email !== process.env.REACT_APP_VALID_MAIL_ADDRESSES) return;
      setMyAccount(user);
      searchUsers();
  });
}, []);

```

`npm start` ã§èµ·å‹•ã™ã‚‹ã¨ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼
![](/images/20200819/ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ_2020-08-18_23.22.08.png)

ã“ã‚Œã§ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ`.env`ã«å®šç¾©ã—ãŸã‚‚ã®ã¨ç•°ãªã‚‹å ´åˆã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¼¾ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã®å…¨é‡ã¯ã“ã¡ã‚‰ã§ã™ã€‚

```ts App.tsx
import React, { useState, useEffect } from 'react';
import './App.css';

// firebase functions
import firebase from 'firebase';
import {fireStore} from './firebase/index'
import StyledFirebaseAuth from 'react-firebaseui/StyledFirebaseAuth';


function App() {
  const [loading, setLoading] = useState(true);
  const [users, setUsers] = useState<firebase.firestore.DocumentData[]>([]);
  const [myAccount, setMyAccount] = useState<firebase.User>();

  const uiConfig = {
    signInFlow: 'popup',
    signInSuccessUrl: '/',
    signInOptions: [
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
    ],
};


  useEffect(() => {
    const searchUsers = async() => {
      // Firestoreã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—
      const res = await fireStore.collection('users').get();
      if (res.empty) return [];
      const userList: firebase.firestore.DocumentData[] = [];
      // DocumentDataå‹ã«ã¯mapãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€forEachã®ãƒ«ãƒ¼ãƒ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥
      res.forEach(doc => {
          userList.push(doc.data());
      })
      setUsers(userList);
    }

    firebase.auth().onAuthStateChanged((user) => {
      setLoading(false);
      if (!user) return;
      if (user.email !== process.env.REACT_APP_VALID_MAIL_ADDRESSES) return;
      setMyAccount(user);
      searchUsers();
  });
}, []);

  return (
    <div className="App">
      <header className="App-header">
        {loading ? (
                  <p>
                  LOADING.....
                </p>
        ) : !myAccount ? (
          <p>
            ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™
          <StyledFirebaseAuth uiConfig={uiConfig} firebaseAuth={firebase.auth()} />
          </p>
        ) :
          users.map((user, index) => {
            return <p key={index}> {user.name}</p>
          })
        }
      </header>
    </div>
  );
}

export default App;

```

# æœ€å¾Œã«

èªè¨¼æ©Ÿèƒ½ã‚’å«ã‚ãŸç”»é¢ã®é–‹ç™ºãŒã„ã¨ã‚‚ç°¡å˜ã«ã§ãã¦ã—ã¾ã„ã¾ã—ãŸã€‚ï¼ˆç’°å¢ƒæ§‹ç¯‰ã®ã‚³ãƒãƒ³ãƒ‰ã¯ç¢ºèªå«ã‚ãŸã£ãŸã®11è¡Œï¼ï¼‰
Firebaseã¯æœ¬å½“ã«å‰å¤§ã§ã—ãŸã€‚
ã‚¢ãƒ—ãƒªä½œã‚‹ã£ã¦ãªã‚“ã ã‹å¤§å¤‰ãã†â€¦ã¨æ€ã£ã¦ã‚‹æ–¹ã®å°è±¡ãŒå°‘ã—ã§ã‚‚å¤‰ã‚ã‚Œã°å¹¸ã„ã§ã™ã€‚
ä½¿ã„ã“ãªã›ã°ã‚‚ã£ã¨ã„ã‚ã‚“ãªã“ã¨ãŒã§ããã†ãªã®ã§ã€å¼•ãç¶šãè§¦ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ï¼
ä»¥ä¸Šã§ã™ã€‚

# å‚è€ƒ
* https://firebase.google.com/docs/web/setup#node.js-%E3%82%A2%E3%83%97%E3%83%AA
* https://qiita.com/kazushikawamura/items/58ea222b3cc289882d79
* https://qiita.com/cola119/items/99350f2c34c51378777e
* https://dev.to/adriantwarog/deno-react-using-create-react-app-with-deno-5fpj

