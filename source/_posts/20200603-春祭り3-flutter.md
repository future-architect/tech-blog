title: "æ˜¥ã®å…¥é–€ç¥­ã‚ŠğŸŒ¸#03 ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹Flutterç”Ÿæ´»"
date: 2020/06/03 11:09:41
tags:
  - Flutter
  - Dart
  - ã‚¢ãƒ—ãƒª
  - introductory
category:
  - Programming
thumbnail: /images/20200603/thumbnail.png
author: "æ‘ç”°é–æ‹“"
featured: false
lede: "æ˜¥ã®å…¥é–€ç¥­ã‚ŠğŸŒ¸ ç¬¬3å¼¾ã¨ã—ã¦ã€å…¼ã­ã¦ã‚ˆã‚Šæ°—ã«ãªã£ã¦ã„ãŸFlutterã«å…¥é–€ã—ã¦ã¿ãŸè©±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚æ™®æ®µã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©å¯„ã‚ŠãªæŠ€è¡“ã‚’è§¦ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å®Ÿã¯ç”Ÿã¾ã‚Œã¨è‚²ã¡ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç•‘ã§ã€éå»ã«ã¯Urushiã¨ã„ã†å½“ç¤¾è£½ã®OSSé–‹ç™ºã«æºã‚ã£ã¦ã„ã¾ã—ãŸã€‚æ˜¨ä»Šã®è‡ªç²›ç”Ÿæ´»ã®ä¸­ã§ç§ã®ãƒãƒ¼ãƒ å†…ã§ã‚‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚‚ãã‚‚ãä¼šï¼ˆç¤¾å†…ã§ã¯é€šç§°ã€Œå¼•ãã“ã‚‚ã‚Šã‚‚ãã‚‚ãã€ï¼‰ãŒæµè¡Œã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ä¹…ã—ã¶ã‚Šã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«è§¦ã‚Œã‚ˆã†ã¨æ€ã„ç«‹ã£ãŸã®ãŒäº‹ã®çµŒç·¯ã§ã™ã€‚"
---

# ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€TIGã®[æ‘ç”°](https://twitter.com/famipapamart)ã§ã™ã€‚[æ˜¥ã®å…¥é–€ç¥­ã‚ŠğŸŒ¸](https://future-architect.github.io/articles/20200529/) ç¬¬3å¼¾ã¨ã—ã¦ã€å…¼ã­ã¦ã‚ˆã‚Šæ°—ã«ãªã£ã¦ã„ãŸFlutterã«å…¥é–€ã—ã¦ã¿ãŸè©±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚

æ™®æ®µã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©å¯„ã‚ŠãªæŠ€è¡“ã‚’è§¦ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å®Ÿã¯ç”Ÿã¾ã‚Œã¨è‚²ã¡ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç•‘ã§ã€éå»ã«ã¯[Urushi](https://github.com/future-architect/urushi)ã¨ã„ã†å½“ç¤¾è£½ã®OSSé–‹ç™ºã«æºã‚ã£ã¦ã„ã¾ã—ãŸã€‚

Urushiã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°ã§è©³ç´°ã«èªã‚‰ã‚Œã¦ã„ã¾ã™ã€‚2017å¹´ã®è¨˜äº‹ã§ã™ã­ã€‚æ‡ã‹ã—ã„é™ã‚Šã§ã™ã€‚
[ES2015 Web componentsã¨å›½ç”£Web componentsãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯Urushi](https://future-architect.github.io/articles/20170605/)

æ˜¨ä»Šã®è‡ªç²›ç”Ÿæ´»ã®ä¸­ã§ç§ã®ãƒãƒ¼ãƒ å†…ã§ã‚‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚‚ãã‚‚ãä¼šï¼ˆç¤¾å†…ã§ã¯é€šç§°ã€Œå¼•ãã“ã‚‚ã‚Šã‚‚ãã‚‚ãã€ï¼‰ãŒæµè¡Œã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ä¹…ã—ã¶ã‚Šã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«è§¦ã‚Œã‚ˆã†ã¨æ€ã„ç«‹ã£ãŸã®ãŒäº‹ã®çµŒç·¯ã§ã™ã€‚

# Flutterã¨ã¯

>Flutter is Googleâ€™s UI toolkit for building beautiful, natively compiled applications for mobile, web, and desktop from a single codebase.

https://flutter.dev/

Flutterã¯Googleè£½ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã¯Androidã¨iOSã ã‘ã§ãªãWebã¾ã§è¡Œãå±Šã„ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ReactNativeãªã©ä»–ã®ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–‹ç™ºãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚‚åŒæ§˜ã§ã™ã­ã€‚

Flutterã®ç‰¹å¾´ã¯ã€é–‹ç™ºè¨€èªã«[Dart](https://dart.dev/)ã¨ã„ã†è¨€èªã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ç‚¹ã§ã™ã€‚Dartã¯Googleè£½ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãªã®ã§ã™ãŒã€æ›¸ãå¿ƒåœ°ã¯JavaScriptã«éå¸¸ã«è¿‘ãã€ä¹…ã—ã¶ã‚Šã«JSã‚’å—œã‚“ã ç§ã§ã‚‚ã¨ã£ã¤ãã‚„ã™ã„è¨€èªã§ã—ãŸã€‚

# ã‚„ã‚ŠãŸã„ã“ã¨

çµ¶è³›ç„¡äººå³¶ç”Ÿæ´»ğŸï¸ã‚’æº€å–«ã—ã¦ã„ãŸç§ã¯ã€Flutterã§ã‚‚ãã‚‚ãã™ã‚‹ã«ã‚ãŸã£ã¦ã€ã€Œã‚«ãƒ–ä¾¡ã®æ¨ç§»ã‚’å¯è¦–åŒ–ã™ã‚‹ã€ã¨ã„ã†ã‚´ãƒ¼ãƒ«ã‚’å®šã‚ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã‚«ãƒ–ä¾¡ã«ã¤ã„ã¦ã®è©³ç´°ã¯å‰²æ„›ã—ã¾ã™ãŒã€æ ªä¾¡ã®ã‚ˆã†ã«æ™‚ç³»åˆ—ã«åˆã‚ã›ã¦ä¸Šä¸‹ã™ã‚‹å€¤ã®æ¨ç§»ã‚’éŠ˜æŸ„(å³¶)ã”ã¨ã«ã‚°ãƒ©ãƒ•ğŸ“ˆåŒ–ã—ãŸã„ã€ã¨ã„ã†ã®ãŒç§ã®ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨ã§ã™ã€‚

Flutterã¯ä»Šå›Webç‰ˆã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®DBã«ã¤ã„ã¦ã¯ã€Firebaseã§ã†ã¾ããƒ©ã‚¤ãƒˆã«ã‚„ã‚Œãªã„ã‹ãªãƒ¼ç¨‹åº¦ã«è€ƒãˆã¦ã„ã¾ã—ãŸã€‚ï¼ˆæœ€çµ‚çš„ã«Cloud Firestoreã‚’æ¡æŠã—ã¦ã¾ã™ãŒã€ãã‚Œã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ï¼‰

<img src="/images/20200603/photo_20200603_01.png">

# å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã‚‹

## ã¾ãšã¯ç’°å¢ƒæ§‹ç¯‰

å…ã«ã‚‚è§’ã«ã‚‚ã¾ãšã¯ç’°å¢ƒæ§‹ç¯‰ã‚’ã—ã¦ã„ãã¾ã™ã€‚ç§ã®ç«¯æœ«ã¯MacOSãªã®ã§ã€[MacOSç”¨ã®æ‰‹é †](https://flutter.dev/docs/get-started/install/macos)ã«å¾“ã£ã¦ç’°å¢ƒæ§‹ç¯‰ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚ã¡ãªã¿ã«ä»Šå›åˆ©ç”¨ã™ã‚‹ã®ã¯Webç‰ˆãªã®ã§ã€[Webç‰ˆå‘ã‘ã®æ‰‹é †](https://flutter.dev/docs/get-started/web)ã‚‚åˆã‚ã›ã¦å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Flutterã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚Flutter Webã‚’ä½¿ã†ã®ã§Channel betaã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```sh
$ flutter --version
Flutter 1.17.0 â€¢ channel beta â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision e6b34c2b5c (4 weeks ago) â€¢ 2020-05-02 11:39:18 -0700
Engine â€¢ revision 540786dd51
Tools â€¢ Dart 2.8.1
```

ã•ã¦ã€æ‰‹é †ã«ã¯mockã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãã‚Œã‚’å‹•ä½œã™ã‚‹ã¨ã“ã‚ã¾ã§å«ã¾ã‚Œã¦ã„ã¾ã™ã®ã§ã€ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```sh
$ flutter create myapp
Creating project myapp...                                          
ãƒ»
ãƒ»
(ä¸­ç•¥)
ãƒ»
ãƒ»
Running "flutter pub get" in myapp...                               1.9s
Wrote 77 files.

All done!
[âœ“] Flutter: is fully installed. (Channel beta, v1.17.0, on Mac OS X 10.14.6 18G4032, locale ja-JP)
[!] Android toolchain - develop for Android devices: is partially installed; more components are available. (Android SDK version 28.0.3)
[âœ—] Xcode - develop for iOS and macOS: is not installed.
[âœ“] Chrome - develop for the web: is fully installed.
[!] Android Studio: is partially installed; more components are available. (version 3.4)
[âœ“] VS Code: is fully installed. (version 1.45.1)
[âœ“] Connected device: is fully installed. (2 available)

Run "flutter doctor" for information about installing additional components.

In order to run your application, type:

  $ cd myapp
  $ flutter run

Your application code is in myapp/lib/main.dart.
```

ã“ã‚Œã§å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒ `myapp` é…ä¸‹ã«ä½œæˆã•ã‚Œã¾ã™ã€‚ `lib/main.dart` ãŒå®Ÿéš›ã«implementã™ã‚‹å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚‹ã®ã§ã™ãŒã€ä¸€æ—¦è§¦ã‚‰ãšã«ã‚¢ãƒ—ãƒªã®èµ·å‹•ã‚’ç¢ºèªã—ã¾ã™ã€‚

```sh
$ cd myapp
$ flutter run -d chrome
```

ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ï¼ç”»é¢ã¯ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã€å³ä¸‹ã®ã€Œ+ãƒœã‚¿ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç”»é¢å†…ã®ã‚«ã‚¦ãƒ³ã‚¿ãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã¦ã„ãã¾ã™ã€‚

<img src="/images/20200603/photo_20200603_02.png" style="border:solid 1px #000000">

ã“ã‚Œã§ã‚¢ãƒ—ãƒªã®é–‹ç™ºç’°å¢ƒã¯æ•´ã„ã¾ã—ãŸã€‚ã§ã¯æ—©é€Ÿã‚¢ãƒ—ãƒªã®é–‹ç™ºã«ç§»ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## ChartJSãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚’è¡Œã†

Flutter(Dart)ã§åˆ©ç”¨ã§ãã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯[pub.dev](https://pub.dev/)ã¨ã„ã†ãƒšãƒ¼ã‚¸ã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯ãã®ä¸­ã‹ã‚‰[flutter_web_chartjs](https://pub.dev/packages/flutter_web_chartjs)ã¨ã„ã†Webç‰ˆFlutterã§ä½¿ãˆã‚‹ChartJSãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚

ä½¿ã„ãŸã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ `pubspec.yaml` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§è¨˜è¼‰ã—ã¾ã™ã€‚

```yaml
dependencies:
  flutter_web_chartjs: ^0.2.5
```

ã“ã‚Œã§æº–å‚™å®Œäº†ã§ã™ã€‚
[Example](https://pub.dev/packages/flutter_web_chartjs#-example-tab-)ã«å¾“ã£ã¦ã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã™ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€è©³ç´°ã¯ã“ã“ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚

<img src="/images/20200603/photo_20200603_03.png" style="border:solid 1px #000000">

ç¸¦è»¸ã¨æ¨ªè»¸ã«è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç¾¤ã‚’ç”¨æ„ã™ã‚Œã°ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

## Firebaseã®DBã¨ç¹‹ããŸã„

DBã¯ãªã‚‹ã¹ãç°¡å˜ã«æ‰±ãˆã‚‹ã‚‚ã®ã«ã—ãŸãã€Cloud Firestoreã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚

ã¡ãªã¿ã«ã€Cloud Firestoreã‚’ä½¿ã†ã‹Realtime Databaseã‚’ä½¿ã†ã‹å°‘ã—ã ã‘æ‚©ã‚“ã ã®ã§ã™ãŒã€ãã®ã¸ã‚“ã¯[ã“ã¡ã‚‰](https://speakerdeck.com/mura123yasu/zerokarashi-merufluttersheng-huo-prologue)ã®è³‡æ–™ã«ã¾ã¨ã‚ã¦ã‚ã‚Šã¾ã™ã€‚

è«¸ã€…ã®èƒŒæ™¯ã¯çœãã¾ã™ãŒã€ã€ŒãŠã¨ãªã—ãCloud Firestoreã‚’Native Modeã§ä½¿ãŠã†ã€ã¨ã„ã†ã®ãŒç§ã®çµè«–ã§ã™ã€‚

### åˆ©ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¿½åŠ 

ã•ã¦ã€å®Ÿè£…ã«ç§»ã£ã¦ã„ãã¾ã™ã€‚å…ˆç¨‹åŒæ§˜ã€ã¾ãšã¯ä½¿ã„ãŸã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ `pubspec.yaml` ã«è¨˜è¼‰ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰ã§ã™ã€‚[cloud_firestore](https://pub.dev/packages/cloud_firestore)ã‚’ä½¿ã†ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã—ãŸã€‚

```yaml
dependencies:
  flutter_web_chartjs: ^0.2.5
  cloud_firestore: ^0.13.5
```

### Firebase Appã®ä½œæˆ

æ¬¡ã«Firebase Appã®ä½œæˆã§ã™ã€‚Firebase Consoleã«ã¦ã€Œã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã€ã‹ã‚‰ä½œæˆã—ã€ `ã‚¢ãƒ—ãƒªID` ã‚’å–å¾—ã—ã¾ã™ã€‚

ãã®éš›ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£ã‚‚æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

<img src="/images/20200603/photo_20200603_04.png" style="border:solid 1px #000000">

ä»Šå›ã¯ `web/index.html` ãŒä¿®æ­£å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚ã“ã®è¾ºã®çµŒç·¯ã¯[GitHubãƒšãƒ¼ã‚¸ã®README](https://github.com/FirebaseExtended/flutterfire/blob/master/packages/cloud_firestore/cloud_firestore_web/README.md)ã«ã‚‚è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚

>Due to this bug in dartdevc, you will need to manually add the Firebase JavaScript files to your index.html file.

Webç‰ˆã®Flutterã¯é‹­æ„ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä¸­ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã€ä»Šå¾Œæ”¹å–„ã•ã‚Œã¦ã„ããƒã‚¤ãƒ³ãƒˆãªã‚“ã ã‚ã†ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚

### `index.html` ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

å¿…è¦ãªå¤‰æ›´ã‚’åŠ ãˆãŸ `index.html` ã® `<body>` ã‚¿ã‚°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```html
<body>
  <!-- Due to this bug in dartdevc, you will need to manually add the Firebase JavaScript files to your index.html file. see: https://github.com/FirebaseExtended/flutterfire/blob/master/packages/cloud_firestore/cloud_firestore_web/README.md-->
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-firestore.js"></script>  
  <!-- This script installs service_worker.js to provide PWA functionality to
       application. For more information, see:
       https://developers.google.com/web/fundamentals/primers/service-workers -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('flutter_service_worker.js');
      });
    }
  </script>
  <!-- ADD THIS BEFORE YOUR main.dart.js SCRIPT -->
  <script>
    // TODO: Replace the following with your app's Firebase project configuration.
    // See: https://support.google.com/firebase/answer/7015592
    var firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- END OF FIREBASE INIT CODE -->
  <script src="main.dart.js" type="application/javascript"></script>
</body>
```

## `main.dart` ã«ã¦æœ¬å®Ÿè£…

ã“ã“ã¾ã§ã®ä¸‹æº–å‚™ãŒæ•´ãˆã°ã€æœ¬å®Ÿè£…ã‚’è¡Œã†ã®ã¿ã§ã™ã€‚
[Example](https://pub.dev/packages/cloud_firestore#-example-tab-)ç­‰ã‚’å‚è€ƒã«ã—ã¤ã¤å®Ÿè£…ã‚’é€²ã‚ãŸã®ãŒä»¥ä¸‹ã§ã™ã€‚

ã¾ãšã¯importæ–‡ã¨mainæ–‡ã€‚FirebaseAppã‚’è¨­å®šã—ã¦ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_web_chartjs/chartjs.models.dart';
import 'package:flutter_web_chartjs/chartjs.wrapper.dart';

import 'dart:async';
import 'package:firebase_core/firebase_core.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  final FirebaseApp app = await FirebaseApp.configure(
    name: 'Turniprice Visualizer',
    options: const FirebaseOptions(
      apiKey: "YOUR_API_KEY",
      projectID: "YOUR_PROJECT_ID",
      googleAppID: "YOUR_APP_ID",
      databaseURL: "YOUR_DATABASE_URL",
      storageBucket: "YOUR_STORAGE_BUCKET",
    ),
  );
  final Firestore firestore = Firestore(app: app);

  runApp(MyApp(firestore: firestore));
}
```

å…ˆç¨‹ `runApp()` ã«å¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚ŒãŸ `MyApp` ã‚¯ãƒ©ã‚¹ã®å®Ÿä½“ã§ã™ã€‚ `_getChartData()` ãŒä»Šå›ã®ã‚­ãƒ¢ã¨ãªã‚‹éƒ¨åˆ†ã§ã‚ã‚Šã€Firestoreã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¨ChartJSã§æç”»ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æ•´å½¢ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚

```dart
class MyApp extends StatefulWidget {
  MyApp({this.firestore});
  final Firestore firestore;

  var values = {};
  List<String> x = [];

  final colors = [
    Colors.blue.withOpacity(0.4),
    Colors.yellow.withOpacity(0.4),
    Colors.red.withOpacity(0.4),
    Colors.green.withOpacity(0.4)
  ];

  Future<ChartData> _getChartData() async {
    // Query documents
    final querySnapshot = await firestore
        .collection("prices")
        .orderBy("date", descending: true)
        .orderBy("ampm", descending: true)
        .getDocuments();
    
    querySnapshot.documents.forEach((doc) => format(doc));

    // ChartDataã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    // datasetsã‚’ä½œæˆ
    List<ChartDataset> datasets = [];
    int count = 0;
    values.forEach((key, value) {
      datasets.add(
        ChartDataset(
          data: value,
          label: key,
          backgroundColor: colors[count],
        )
      );
      count++;
    });

    final chartData = ChartData(
      labels: x,
      datasets: datasets,
    );

    return chartData;
  }

  void format(DocumentSnapshot doc) {
    print(doc["date"] + "/"+ doc["ampm"] + "/"+ doc["label"] + "/"+ doc["val"].toString());

    // "date+ampm"ãŒxã«ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã—ã€ã„ãªã‘ã‚Œã°ãƒªã‚¹ãƒˆã«è¿½åŠ 
    var xVal = doc["date"] + doc["ampm"];
    if (!x.contains(xVal)) {
      x.add(xVal);
    }

    // labelã‚’ã‚­ãƒ¼ã«ã—ãŸãƒªã‚¹ãƒˆãŒvaluesã«ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã—ã€ã„ãªã‘ã‚Œã°ãƒªã‚¹ãƒˆã«è¿½åŠ 
    values[doc["label"]] ??= [];
    // valueã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
    values[doc["label"]].add(doc["val"]);
  }

  @override
  _MyAppState createState() => _MyAppState();
}
```

ã¡ãªã¿ã«ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

<img src="/images/20200603/photo_20200603_05.png" style="border:solid 1px #000000">

æœ€å¾Œã«Stateã‚¯ãƒ©ã‚¹ã§ã™ã€‚ `MyApp` ã‚¯ãƒ©ã‚¹ã¯ `StatefulWidget` ãªã®ã§ã“ã®Stateã‚¯ãƒ©ã‚¹ã«ã¦buildå‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚å®Ÿè£…æ™‚ã«æ°—ã«ã—ãŸãƒã‚¤ãƒ³ãƒˆã¯å¾Œè¿°ã—ã¾ã™ã€‚

```dart
class _MyAppState extends State<MyApp> {

  @override
  void initState() {
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Turniprice Visualizer'),
        ),
        body: Center(
          child: FutureBuilder(
            future: widget._getChartData(),
            builder: (BuildContext context, AsyncSnapshot<ChartData> snapshot) {
              // é€šä¿¡ä¸­
              if (snapshot.connectionState != ConnectionState.done) {
                return CircularProgressIndicator();
              }
              // é€šä¿¡çµ‚äº†ã ãŒã‚¨ãƒ©ãƒ¼ã‚ã‚Š
              if (snapshot.hasError) {
                print("[USER-ERROR]" + snapshot.error.toString());
                return Text(snapshot.error.toString());
              }
              // é€šä¿¡æ­£å¸¸çµ‚äº†
              if (snapshot.hasData) {
                print("[USER-INFO]Fetching data succeeded.");
                return ChartJS(
                    id: 'graph',
                    config: ChartConfig(
                        type: ChartType.line,
                        options: ChartOptions(
                            animationConfiguration: ChartAnimationConfiguration(
                              duration: Duration(milliseconds: 1200),
                              easing: ChartEasing.easeOutQuart,
                            ),
                            scales: ChartScales(
                              xAxes: [
                                ChartAxis(
                                  type: ChartCartesianAxisType.category,
                                )
                              ],
                            ),
                            tooltip: ChartTooltip(
                                intersect: false,
                                mode: ChartTooltipMode.isIndex,
                                callbacks: ChartCallbacks(label: (tooltip) {
                                  return 'R\$ ${tooltip.value}';
                                }))),
                        data: snapshot.data),
                  );
              } else {
                print("[USER-INFO]Fetching data failed.");
                return Text('No Data');
              }
            },
          ),
        ),
      ),
    );
  }
}
```

## `main.dart` å®Ÿè£…æ™‚ã«æ°—ã«ã—ãŸã“ã¨

### `StatefulWidget` vs `StatelessWidget`

Widgetã«ã¯ `Stateful` ã¨ `Stateless` ã®2ç¨®é¡ãŒã‚ã‚Šã€[Flutter Doc JP](https://flutter.ctrnost.com/tutorial/tutorial05/)ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

<img src="/images/20200603/photo_20200603_06.png" style="border:solid 1px #000000">

ä»Šå›åˆ©ç”¨ã—ã¦ã„ã‚‹ChartJSãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãŠã„ã¦ `ChartJS` ã‚¯ãƒ©ã‚¹ã¯ `StatefulWidget` ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ãŸãŸã‚ã€ `MyApp` ã‚¯ãƒ©ã‚¹ã¯ `StatefulWidget` ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ç”¨é€”çš„ã«ã¯ã€åˆå›é€šä¿¡ã§ã®ã¿å€¤ã‚’å–å¾—ãŠã‚ˆã³æç”»ã§ãã‚Œã°ã‚ˆã‹ã£ãŸã®ã§ã€ `StatelessWidget` ã§ã‚‚è‰¯ã„ã®ã‹ãªã¨æ€ã„ã¾ã—ãŸãŒã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…ã«å¾“ã†å½¢ã§ `StatefulWidget` ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

### `FutureBuilder` vs `StreamBuilder`

ç´ ã®Builderã‚’ä½¿ã†ã¨ã€Cloud Firestoreã®ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã™ã‚‹å‰ã«ç”»é¢ã®æç”»å‡¦ç†ãŒèµ°ã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€éåŒæœŸé€šä¿¡ã‚’å¾…ã¤Builderã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

éåŒæœŸBuilderã«ã¯ `FutureBuilder` ã¨ `StreamBuilder` ã®2ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚

* StreamBuilder
    * éåŒæœŸå‡¦ç†ã®æ›´æ–°ã™ã‚‹å¤‰æ•°ãŒå¤‰åŒ–ã™ã‚‹åº¦ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’buildã—ç›´ã™Builder
* FutureBuilder
    * æŒ‡å®šã—ãŸéåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’å¾…ã¤Builder

ä¸Šè¨˜ã®èª¬æ˜ã¯[ã“ã¡ã‚‰](https://qiita.com/sshon/items/9005cd64a4fc9f9b6a45)ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰æ‹å€Ÿã—ã¾ã—ãŸã€‚

ä»Šå›ã®ã‚¢ãƒ—ãƒªã§ã¯åˆå›ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã¿ã‚’å¾…ã¦ã°ã‚ˆã„ã®ã§ã€Builderã¯ `FutureBuilder` ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

# ãŠã‚ã‚Šã«
ä»Šå›ã¯Flutterå…¥é–€è¨˜äº‹ã¨ã„ã†ã“ã¨ã§ã€ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã™ãŒFirebaseã‚’åˆ©ç”¨ã—ãŸã‚¢ãƒ—ãƒªé–‹ç™ºã‚’ã”ç´¹ä»‹ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚

ãã‚Œã«ã—ã¦ã‚‚Dartã¨ã„ã†é–‹ç™ºè¨€èªã€Futureç¤¾å“¡ã®ç§ã«ã¨ã£ã¦Futureå‹ã®å­˜åœ¨ãŒãªã«ã‹ç‰¹åˆ¥ãªæ„Ÿæƒ…ã‚’ã‚‚ãŸã‚‰ã—ã¦ãã‚Œã¾ã—ãŸã€‚

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">Flutterã§ã‚¢ãƒ—ãƒªæ›¸ã„ã¦ã‚‹ã‘ã©ä½•å›ã‚‚&quot;Future&quot;ã£ã¦ç™»å ´ã—ã¦ã¦ã€çŸ¥ã‚‰ã¬é–“ã«æ„›ç¤¾ç²¾ç¥ãŒç£¨ã‹ã‚Œã¦ã‚‹æ°—ãŒã™ã‚‹ã€‚Dart...ãŠå‰ã¾ã•ã‹...</p>&mdash; Yasuhiro Murata (@famipapamart) <a href="https://twitter.com/famipapamart/status/1254307447117737984?ref_src=twsrc%5Etfw">April 26, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

...ã¨ã„ã†å†—è«‡ã¯ã•ã¦ãŠãã€æ›¸ã„ã¦ã„ã‚‹é–“ã«æ¥½ã—ã„æ°—åˆ†ã«ã•ã›ã¦ãã‚Œã‚‹è¨€èªã¨ã„ã†ã®ã‚‚ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã ã¨æ€ã†ã®ã§ã€ã“ã®æ„Ÿæƒ…ã¯ã“ã‚Œã‹ã‚‰ã‚‚å¤§äº‹ã«ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

æ˜¥ã®å…¥é–€ç¥­ã‚ŠğŸŒ¸ ã¯ã¾ã ã¾ã ç¶šãã¾ã™ï¼FutureæŠ€è¡“ãƒ–ãƒ­ã‚°å§‹ã¾ã£ã¦ä»¥æ¥ã®è¶…å¤§å‹é€£è¼‰ã€ãœã²ãœã²æœ€å¾Œã¾ã§ãŠä»˜ãåˆã„ãã ã•ã„ï¼ï¼

